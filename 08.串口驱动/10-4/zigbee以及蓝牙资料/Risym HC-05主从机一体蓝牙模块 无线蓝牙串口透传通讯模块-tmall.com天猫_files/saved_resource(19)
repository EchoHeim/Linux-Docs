KISSY.add("malldetail/body/combo",function(e,t,a,i,n){var r,l,o=4;return{renderCombo:function(r,l,s){_CTKeccb(33,"mod.combo.render","view.mainBody.init");if(r._inited){return}r._inited=true;l.onLoad(["comboData","products"],function(c,d){l.onMap(d,["itemData","originalPrice"],function(e,t){return{itemData:e,originalPrice:t}},function(m){_CTKeccb(33,"mod.combo.show","mod.combo.render");if(c.type==1){t.addClass(r,"ziyou")}if(c.group==5){t.addClass(r,"juepei")}var u=[];for(var p in m){var v=m[p];u.push(v)}u.sort(function k(e,t){var a;try{a=e.itemData.sortOrder-t.itemData.sortOrder}catch(i){a=0}return a});t.html(r,n({comboData:c,items:u}));var f=t.get(".tm-combo-items",r),g=t.query(".tm-combo-item",f);if(g.length>o){var h;t.addClass(f,"tab-content tab-content-groups");for(var _=0;_<g.length;_++){if(_%o===0){h=t.create('<div class="tab-pannel tab-pannel-groups'+(_===0?"":" hidden")+'">');t.append(h,f)}t.append(g[_],h)}var b=t.create('<div class="tab-nav-groups"><a href="javascript:void(0);" target="_self" class="trigger-prev j_Trigger disabled">&#xe62c;</a><a href="javascript:void(0);" target="_self" class="trigger-next j_Trigger">&#xe62b;</a></div>');t.insertBefore(b,f);e.use("node,gallery/slide/1.3/",function(e,i,n){var l=new n(i.one(r),{effect:"vSlide"});l.on("switch",function(){if(l.is_first()){t.addClass(t.get(".trigger-prev",b),"disabled")}else{t.removeClass(t.get(".trigger-prev",b),"disabled")}if(l.is_last()){t.addClass(t.get(".trigger-next",b),"disabled")}else{t.removeClass(t.get(".trigger-next",b),"disabled")}});a.delegate(b,"click","a",function(e){var a=e.target;if(t.hasClass(a,"disabled")){return}if(t.hasClass(a,"trigger-prev")){l.previous()}else{l.next()}})})}e.each(d,function(e){e.onChange(["itemData","originalPrice"],function(e,a){t.html(t.get("s",t.get(".tm-original-price",t.get(".tm-combo-i"+e.itemId,r))),a.str)});e.onLoad(["itemData"],function(i){var n=t.get(".tm-enable",t.get(".tm-combo-i"+i.itemId,r));if(n){e.onChange("canBuyStatus",function(){e.canBuy({level:4},function(e){if(e.level){t.addClass(n,"disabled")}else{t.removeClass(n,"disabled")}})})}if(c.type==1&&n){e.onChange("itemEnable",function(e){if(e){t.addClass(n,"selected");t.removeClass(t.get(".header",r),"warnning")}else{t.removeClass(n,"selected")}});a.on(n,"click",function(a){if(t.hasClass(n,"disabled")||t.hasClass(n,"force")){return}a.halt();if(t.hasClass(n,"selected")){e.set("itemEnable",false)}else{e.set("itemEnable",true)}})}})});l.onChange(["originalPrice","comboPrice","saveMoney"],function(e,a,i){var n=t.get(".tm-combo-info",r);t.html(t.get("s",t.get(".tm-combo-price",n)),a.str);if(i&&i.max*1){t.html(t.get("s",t.get(".tm-save-price",n)),i.str);t.show(t.get(".tm-save-price",n))}else{t.hide(t.get(".tm-save-price",n))}t.html(t.get("s",t.get(".tm-original-price",n)),e.str)});var y=i.createLoader(function(a){e.use("malldetail/control/dialog",function(e,n){var r=new n({content:'<div class="J_ComboDialog" data-spm="1998099589"></div>',align:{offset:[0,32],points:["tc","tc"]},scrollEl:".scroll",height:550});r.show();_CTKeccb(33,"mod.combo.showDialog","mod.combo.click");r.onMod=i.createLoader(function(a){l.set("noCache",true);e.use("malldetail/body/comboPanel",function(e,i){var n=new i({el:t.get(".J_ComboDialog",r.get("el")),combo:l,delivery:s});a(n)})});r.setType=function(){var e=arguments;r.onMod(function(t){t.setType.apply(t,e)},1)};r.onMod(function(e){},1);r.on("hide",function(){r.onMod(function(e){e.hide()},2)});a(r)})});a.delegate(r,"click",".J_ComboBuy",function(e){_CTKeccb(33,"mod.combo.click","mod.combo.show");y(function(e){e.setType(1);e.show()});TShop.sendAtpanel("tmalldetail.36.1")});a.delegate(r,"click",".J_ComboAddCart",function(e){_CTKeccb(33,"mod.combo.click","mod.combo.show");y(function(e){e.setType(2);e.show()});TShop.sendAtpanel("tmalldetail.36.2")})})})},init:function(a){var i=a.el,n=this;l=a.product;_CTKeccb(33,"mod.combo.init","mod.combo.init");l.onChange("comboList",function(a){t.empty(i);if(!a){return}var s="",c="";e.each(a,function(e,t){s+='<li class="'+(t===0?"selected":"")+'"">'+e.name+"</li>";c+='<div class="tab-pannel tab-pannel-combos '+(t===0?"":"hidden")+'" data-comboid="'+e.id+'""></div>'});l.onLoad("config",function(d){if(d.newSkuRight&&d.isTmallComboSupport&&d.detail.showRightRecommend&&!/standard=1/.test(window.location.search)){o=3;t.html(i,'<div class="tm-combo-inner"><ul class="tab-nav tab-nav-combos">'+s+'</ul><div class="tab-content tab-content-combos">'+c+"</div></div>")}else{t.html(i,'<ul class="tab-nav tab-nav-combos">'+s+'</ul><div class="tab-content tab-content-combos">'+c+"</div>")}l.set("currentComboId",a[0].id);if(a.length>=1){e.use("node,gallery/slide/1.3/",function(e,a,n){r=new n(a.one(i),{effect:"hSlide"});r.on("switch",function(e){l.set("currentComboId",t.attr(e.pannelnode,"data-comboid"))})})}l.onChange(["currentCombo","delivery"],function(a,o){a.onLoad("comboData",function(s){if(!s){l.onLoad("currentComboId",function(a){e.each(t.query(".tab-pannel-combos",i),function(e,i){if(a!=t.attr(e,"data-comboid")){return}t.html(e,'<div class="tm-combo-error">\u55b5\uff0c\u4e0b\u624b\u592a\u6162\uff0c\u60a8\u76f8\u4e2d\u7684\u5546\u54c1\u8dd1\u8def\u4e86~</div>')})});return}e.each(t.query(".tab-pannel-combos",i),function(e,i){if(s.id!=t.attr(e,"data-comboid")){return}if(r){r.go(i)}n.renderCombo(e,a,o)})})})})})}}},{requires:["dom","event","malldetail/common/util","malldetail/body/combo.tpl","malldetail/body/combo.css"]});