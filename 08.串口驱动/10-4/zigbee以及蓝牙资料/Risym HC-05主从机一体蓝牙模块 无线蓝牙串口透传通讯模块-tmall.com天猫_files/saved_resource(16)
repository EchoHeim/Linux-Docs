KISSY.add("shop/dc/headArchive/index.tpl",function(a,e){var r;var n=function t(a){var e;var r;var n;var t;var l;var i;var s;var v;var o;var d;var c;var p=this;var u=p.root;var m=p.buffer;var f=p.scope;var h=p.runtime;var g=p.name;var x=p.pos;var b=f.data;var w=f.affix;var L=u.nativeCommands;var U=u.utils;var y=U["callFn"];var E=U["callDataFn"];var k=U["callCommand"];var _=L["range"];var I=L["foreach"];var T=L["forin"];var j=L["each"];var S=L["with"];var A=L["if"];var C=L["set"];var D=L["include"];var F=L["parse"];var B=L["extend"];var N=L["block"];var M=L["macro"];var z=L["debugger"];function P(a,e,r){var n=a.data;var t=a.affix;e.data+='\n        <h3 class="hd shopCertificate">\n            <div class="name"><b>&#xe600;</b>\u5929\u732b\u56fd\u9645\u5b98\u65b9\u8ba4\u8bc1</div>\n\n        </h3>\n        ';return e}function q(a,e,r){var n=a.data;var t=a.affix;e.data+=" noneStyle ";return e}function X(a,e,r){var n=a.data;var t=a.affix;e.data+='\n        <div class="shop-cert shop-3c"><a class="icon" target="_blank" href="//3c.tmall.com/"></a>\n            <div class="text" target="_blank">\u7535\u5668\u57ce\u8ba4\u8bc1\u5546\u5bb6</div>\n        </div>\n        ';return e}function O(a,e,r){var n=a.data;var t=a.affix;e.data+='\n        <div class="shop-cert shop-house"><a class="icon" target="_blank" href="//jia.tmall.com/"></a>\n            <div class="text" target="_blank">\u5df2\u52a0\u5165\u5929\u732b\u5bb6\u88c5\u9986</div>\n        </div>\n        ';return e}function H(a,e,r){var n=a.data;var t=a.affix;e.data+='\n        <div class="shop-cert shop-yc"><a class="icon" target="_blank" href="//brand.tmall.com/yuanChuang.htm"></a>\n            <div class="text" target="_blank">\u5929\u732b\u539f\u521b\u5b98\u65b9\u8ba4\u8bc1</div>\n        </div>\n        ';return e}function Y(a,n,t){var l=a.data;var i=a.affix;n.data+='\n        <div class="shop-cert shop-ages">\n            <span class="icon">';x.line=35;var s=(e=i.cfg)!==t?e!=null?r=e.tmShopAges:e:(e=l.cfg)!==t?e!=null?r=e.tmShopAges:e:a.resolveLooseUp(["cfg","tmShopAges"]);n=n.writeEscaped(s);n.data+='</span>\n            <div class="text">\u5929\u732b';x.line=36;var v=(e=i.cfg)!==t?e!=null?r=e.tmShopAges:e:(e=l.cfg)!==t?e!=null?r=e.tmShopAges:e:a.resolveLooseUp(["cfg","tmShopAges"]);n=n.writeEscaped(v);n.data+="\u5e74\u5e97</div>\n        </div>\n        ";return n}function V(a,e,r){var n=a.data;var t=a.affix;e.data+="\u63cf \u8ff0";return e}function J(a,e,r){var n=a.data;var t=a.affix;e.data+="\u670d \u52a1";return e}function K(a,e,r){var n=a.data;var t=a.affix;e.data+="\u7269 \u6d41";return e}function R(a,r,n){var t=a.data;var l=a.affix;r.data+="";var i=(e=l.xindex)!==n?e:(e=t.xindex)!==n?e:a.resolveLooseUp(["xindex"]);var s=i;s=i===1;r=A.call(p,a,{params:[s],fn:J,inverse:K},r);r.data+="";return r}function $(a,e,r){var n=a.data;var t=a.affix;e.data+="shopdsr-score-up-ctrl";return e}function Q(a,e,r){var n=a.data;var t=a.affix;e.data+="shopdsr-score-down-ctrl";return e}function G(a,e,r){var n=a.data;var t=a.affix;e.data+="shopdsr-score-equal-ctrl";return e}function W(a,r,n){var t=a.data;var l=a.affix;r.data+="";var i=(e=l.rate_UFB)!==n?e:(e=t.rate_UFB)!==n?e:a.resolveLooseUp(["rate_UFB"]);var s=i;s=i===2;r=A.call(p,a,{params:[s],fn:Q,inverse:G},r);r.data+="";return r}function Z(a,e,r){var n=a.data;var t=a.affix;e.data+='<s class="shopdsr-score-up"></s>';return e}function aa(a,e,r){var n=a.data;var t=a.affix;e.data+='<s class="shopdsr-score-down"></s>';return e}function ea(a,e,r){var n=a.data;var t=a.affix;e.data+='<s class="shopdsr-score-equal"></s>';return e}function ra(a,r,n){var t=a.data;var l=a.affix;r.data+="";var i=(e=l.rate_UFB)!==n?e:(e=t.rate_UFB)!==n?e:a.resolveLooseUp(["rate_UFB"]);var s=i;s=i===2;r=A.call(p,a,{params:[s],fn:aa,inverse:ea},r);r.data+="";return r}function na(a,r,n){var t=a.data;var l=a.affix;r.data+='\n            <div class="shopdsr-item">\n                <div class="shopdsr-title">';x.line=43;var i=(e=l.xindex)!==n?e:(e=t.xindex)!==n?e:a.resolveLooseUp(["xindex"]);var s=i;s=i===0;r=A.call(p,a,{params:[s],fn:V,inverse:R},r);r.data+='</div>\n                <div class="shopdsr-score ';x.line=44;var v=(e=l.rate_UFB)!==n?e:(e=t.rate_UFB)!==n?e:a.resolveLooseUp(["rate_UFB"]);var o=v;o=v===0;r=A.call(p,a,{params:[o],fn:$,inverse:W},r);r.data+='">\n                    <span class="shopdsr-score-con">';x.line=45;var d=(e=l.rate)!==n?e:(e=t.rate)!==n?e:a.resolveLooseUp(["rate"]);r=r.writeEscaped(d);r.data+="</span>\n                    ";x.line=46;var c=(e=l.rate_UFB)!==n?e:(e=t.rate_UFB)!==n?e:a.resolveLooseUp(["rate_UFB"]);var u=c;u=c===0;r=A.call(p,a,{params:[u],fn:Z,inverse:ra},r);r.data+="\n                </div>\n            </div>\n            ";return r}function ta(a,r,n){var t=a.data;var l=a.affix;r.data+='\n        <div class="main-info">\n            ';x.line=41;x.line=41;var i=(e=l.rates)!==n?e:(e=t.rates)!==n?e:a.resolveLooseUp(["rates"]);r=j.call(p,a,{params:[i],fn:na},r);r.data+='\n            <a target="_blank" href="';x.line=50;var s=(e=l.shopRateUrl)!==n?e:(e=t.shopRateUrl)!==n?e:a.resolveLooseUp(["shopRateUrl"]);r=r.writeEscaped(s);r.data+='" style="z-index: 1;display: block; position: absolute; width: 100%;height: 100%;"></a>\n        </div>\n        ';return r}function la(a,e,r){var n=a.data;var t=a.affix;e.data+="  nohover ";return e}function ia(a,e,r){var n=a.data;var t=a.affix;e.data+='\n            <div class="rateUrl">\n                <a href="#" id="letter-cert">\u5b98\u65b9\u8d44\u8d28\u8be6\u60c5<b>&#xe61a;</b></a>\n            </div>\n            ';return e}function sa(a,t,l){var i=a.data;var s=a.affix;t.data+='\n        <div class="certificateBlock ';x.line=55;var v=(e=s.cfg)!==l?e!=null?r=e.certShopList:e:(e=i.cfg)!==l?e!=null?r=e.certShopList:e:a.resolveLooseUp(["cfg","certShopList"]);var o=!v;if(!o){var d=(e=s.cfg)!==l?e!=null?(r=e.certShopList)!=null?n=r.length:r:e:(e=i.cfg)!==l?e!=null?(r=e.certShopList)!=null?n=r.length:r:e:a.resolveLooseUp(["cfg","certShopList","length"]);o=!d}t=A.call(p,a,{params:[o],fn:la},t);t.data+=' ">\n            <div class="banner">\n                <div class="wrap">\n                    <div class="circle">\n                        <img  src=\'';x.line=59;var c=(e=s.shopCertificateIcon)!==l?e:(e=i.shopCertificateIcon)!==l?e:a.resolveLooseUp(["shopCertificateIcon"]);t=t.writeEscaped(c);t.data+="' width='54' height='48' />\n                    </div>\n                </div>\n            </div>\n             ";x.line=63;var u=(e=s.cfg)!==l?e!=null?r=e.certShopList:e:(e=i.cfg)!==l?e!=null?r=e.certShopList:e:a.resolveLooseUp(["cfg","certShopList"]);var m=u;if(m){var f=(e=s.cfg)!==l?e!=null?(r=e.certShopList)!=null?n=r.length:r:e:(e=i.cfg)!==l?e!=null?(r=e.certShopList)!=null?n=r.length:r:e:a.resolveLooseUp(["cfg","certShopList","length"]);var h=f;h=f>0;m=h}t=A.call(p,a,{params:[m],fn:ia},t);t.data+="\n\n        </div>\n        ";return t}m.data+='<div id="side-shop-info" data-spm="1997427133">\n    <div class="shop-intro">\n        ';x.line=3;var va=(e=w.shopCertificateIcon)!==a?e:(e=b.shopCertificateIcon)!==a?e:f.resolveLooseUp(["shopCertificateIcon"]);m=A.call(p,f,{params:[va],fn:P},m);m.data+='\n\n        <h3 class="hd ';x.line=10;var oa=(e=w.shopCertificateIcon)!==a?e:(e=b.shopCertificateIcon)!==a?e:f.resolveLooseUp(["shopCertificateIcon"]);m=A.call(p,f,{params:[oa],fn:q},m);m.data+='">\n            <div class="name">\n                <a data-spm="d4918065" class="shopLink" href="';x.line=12;var da=(e=w.shopHref)!==a?e:(e=b.shopHref)!==a?e:f.resolveLooseUp(["shopHref"]);m=m.writeEscaped(da);m.data+='" target="_blank">';var ca=(e=w.shopName)!==a?e:(e=b.shopName)!==a?e:f.resolveLooseUp(["shopName"]);m=m.writeEscaped(ca);m.data+='</a>\n                <span class="J_WangWang" data-icon="small" data-nick="';x.line=13;var pa=(e=w.wwNick)!==a?e:(e=b.wwNick)!==a?e:f.resolveLooseUp(["wwNick"]);m=m.writeEscaped(pa);m.data+='" data-tnick="';var ua=(e=w.wwNick)!==a?e:(e=b.wwNick)!==a?e:f.resolveLooseUp(["wwNick"]);m=m.writeEscaped(ua);m.data+='" data-encode="true" data-display="inline" data-from="cntaobao"></span>\n            </div>\n            <i></i>\n        </h3>\n\n        ';x.line=18;var ma=(e=w.cfg)!==a?e!=null?r=e.isShowEcityIcon:e:(e=b.cfg)!==a?e!=null?r=e.isShowEcityIcon:e:f.resolveLooseUp(["cfg","isShowEcityIcon"]);m=A.call(p,f,{params:[ma],fn:X},m);m.data+="\n        ";x.line=23;var fa=(e=w.cfg)!==a?e!=null?r=e.isShowHouseIcon:e:(e=b.cfg)!==a?e!=null?r=e.isShowHouseIcon:e:f.resolveLooseUp(["cfg","isShowHouseIcon"]);m=A.call(p,f,{params:[fa],fn:O},m);m.data+="\n        ";x.line=28;var ha=(e=w.cfg)!==a?e!=null?r=e.isShowYuanchuanIcon:e:(e=b.cfg)!==a?e!=null?r=e.isShowYuanchuanIcon:e:f.resolveLooseUp(["cfg","isShowYuanchuanIcon"]);m=A.call(p,f,{params:[ha],fn:H},m);m.data+="\n        ";x.line=33;x.line=33;var ga=(e=w.cfg)!==a?e!=null?r=e.isShowShopAges:e:(e=b.cfg)!==a?e!=null?r=e.isShowShopAges:e:f.resolveLooseUp(["cfg","isShowShopAges"]);m=A.call(p,f,{params:[ga],fn:Y},m);m.data+="\n        ";x.line=39;x.line=39;var xa=(e=w.cfg)!==a?e!=null?r=e.isShowRates:e:(e=b.cfg)!==a?e!=null?r=e.isShowRates:e:f.resolveLooseUp(["cfg","isShowRates"]);m=A.call(p,f,{params:[xa],fn:ta},m);m.data+="\n\n        ";x.line=54;x.line=54;var ba=(e=w.shopCertificateIcon)!==a?e:(e=b.shopCertificateIcon)!==a?e:f.resolveLooseUp(["shopCertificateIcon"]);m=A.call(p,f,{params:[ba],fn:sa},m);m.data+='\n        <div class="btnArea"><a data-spm="d4918061" href="';x.line=71;var wa=(e=w.shopHref)!==a?e:(e=b.shopHref)!==a?e:f.resolveLooseUp(["shopHref"]);m=m.writeEscaped(wa);m.data+='" target="_blank" class="enterShop">\u8fdb\u5e97\u901b\u901b</a></div>\n    </div>\n</div>';return m};return function(a){r=r||new e(n);return r&&r.render(a)||""}},{requires:["kg/xtemplate/4.1.4/runtime"]});KISSY.add("mui/searchbar/instance/detail",function(e,a,r,t,i,s,o,n,u,c,l,m,h,p,d,g,b,f){var v=window,C=v.g_config||{},w=C["bizId"]||"",x=C["sysId"]||"detail",q=C["devId"]||"pc",y=w+"."+x+"."+q,S="//suggest.taobao.com/sug";var A=(new b).getCurBt(),k=i.get("unb")||"",I=i.get("tracknick")||"",B=!!i.get("login");window._CTK3417=window._CTK3417||function(){var e={},a="",r=0;function t(e){var a=0,r,t,i;if(e.length===0)return a;for(r=0,i=e.length;r<i;r++){t=e.charCodeAt(r);a=(a<<5)-a+t;a|=0}return a}return function(i,s,o,n){n=n||{};if(n.reject){if(typeof n.reject!="object"){n.reject=[n.reject]}for(var u=n.reject.length-1;u>=0;u--){if(e[n.reject[u]]){return}}}if(!a){a=s}var c=(new Date).valueOf();e[s]=c;var l;if(s==a){var m=window.g_config&&g_config.startTime;l=m?c-m:0}else{l=c-(e[o||a]||e[a])}switch(n.autoGroup){case"time":n.group=n.autoGroup+"_"+(l<=0?0:Math.floor(Math.log(l)/Math.log(2)));break}if(typeof i=="object"){i=i[n.group||"_"]||Math.round(Math.log((undefined||8192)/(undefined||1/16))/Math.log(2))}var h=null,p=h&&h[Math.floor((c+288e5)/(864e5/144))%144]||1,d=Math.round(Math.max(Math.pow(2,i)*p/(undefined||8192),1));if(Math.floor(Math.random()*d)>0){return}function g(e,a){var i="undefined"+r++,s=window[i]=new Image;s.onload=s.onerror=function(){window[i]=null};var o=["type="+encodeURIComponent(n.type||"normal"),"name="+encodeURIComponent(e),"parent="+encodeURIComponent(a||""),"module="+encodeURIComponent(n.dataId||"30"),"msg="+encodeURIComponent(n.msg||""),"version="+encodeURIComponent("3.3.28"),"sample="+d,"time="+(l>0?l:0)].join("&");s.src="//gm.mmstat.com/tmjs.1.1?"+o+"&hash="+t(o)}if(n.group){g(s+"|"+n.group,s)}g(s,o)}}();_CTK3417(30,"codetrack.init");var _={build:function(i){if(arguments.length==3||arguments.length==2){var b=arguments[0];var v=arguments[1];var w=arguments[2];i={};i.node=b;i.inShopAction=v;i.inShopBtn=w}i=i||{};var q=i.node||"#mq",B=i.inShopAction||"",_=i.inShopBtn,T=!!i.autoFocus,M=i.extraParams,N=i.placeholder||{},E=i.query||s.UNKNOWN,U=i.nid,j="//suggest.taobao.com/sug?area=b2c&code=utf-8&k=1&src=tmall_pc",P=x=="detail"?false:true;if(!P){S+="?area=getdetailsuggest&nid="+U}else{S+="?area=tmall-hq&src=userid_"+U}S+="&u="+I+"&userid="+k+"&bucketid="+A;var D=C.searchbarCfg=C.searchbarCfg||{},K=!!D.isTestBt;if(K){j=j.replace(/\barea=b2c\b/gi,"area=b2c_bts")}var O=a.one(q),R=O?O.parent("form"):undefined,F=R?R[0].redirect:undefined,Q=F?F.value:"";var L=new n({text:N.text||"\u641c\u7d22 \u5929\u732b \u5546\u54c1/\u54c1\u724c/\u5e97\u94fa",query:N.query||"",redirectUrl:N.redirectUrl||Q});var W=N.cfgTMSUrl||S;var H=new g;H.set("container",R.parent());W&&r({url:W,success:function(a){if(a.success){if(a.model&&a.model.placeholder){L.update(a.model.placeholder[0])}if(P){H.set("data",a.model.list)}else if(a.result&&a.result[0]&&a.result[0].record&&a.result[0].record[0]){var r=[];e.each(t.parse(a.result[0].record[0]["detail_value"]||"").result,function(e,a){var t=e[0].split("|");r.push({query:t[0],cat:t[1]})});H.set("data",r)}}else{L.update(a)}},scriptCharset:"utf-8",dataType:"jsonp"});var Y=new s({plugins:[L,new o({}),new u({action:B||"",button:_||"#J_CurrShopBtn"}),H],sugConfig:{url:j,node:q||"#mq",autoFocus:T,autoExpand:true,extraParams:M||{}},templates:{act:c,meetingPlace:f,shipShop:l,cat:m,list:h,shop:p,quickSearch:d},query:E,acceptCharset:"gbk",dim:y,log:{pageType:1}});_CTK3417(30,"app.init");_CTK3417(30,"detail","app.init",{group:location.hostname});return Y}};return _},{requires:["node","ajax","json","cookie","mui/searchbar/base","mui/searchbar/plugin/spm","mui/searchbar/plugin/placeholder","mui/searchbar/plugin/inShop","mui/searchbar/template/act","mui/searchbar/template/shipShop","mui/searchbar/template/cat","mui/searchbar/template/list","mui/searchbar/template/shop","mui/searchbar/template/quickSearch","mui/searchbar/plugin/hq4Pc","mui/bucket/index","mui/searchbar/template/meetingPlace","mui/searchbar/suggest.css"]});KISSY.version>=1.4&&KISSY.config({modules:{sizzle:{alias:["node"]},"rich-base":{alias:["base"]},ajax:{alias:["io"]}}});KISSY.add("mui/searchbar/base",function(S,Node,RichBase,D,ComboBox,UA,Cookie,E,IO){var TIP="\u8bf7\u8f93\u5165\u641c\u7d22\u6587\u5b57",UNKNOWN="unknown",VALUE="{VALUE}",ltIE9=UA.ie<9,win=window;function makeCacheNum(){return Math.floor(Math.random()*268435456).toString(16)}var SearchBar=RichBase.extend([],{initializer:function(){this._initComboxBox();this._bindSubmitEvent();this._other();this._loadConfig()},_initComboxBox:function(){var e=this,a=e._buildDataSourceCfg(),t=new ComboBox.RemoteDataSource(a),r=e._buildComboBoxCfg(t),i=e.comboBox=new ComboBox(r);var s=i.sendRequest;i.sendRequest=function(a){a=S.trim(a);if(e.fire("beforeQueryChange",{query:a})!==false){s.call(this,a)}};i.normalizeData=function(e){var a=this,t;if(a.get("format")){t=a.get("format").call(a,(a["getValueInternal"]||a["getValueForAutocomplete"]).call(a),e)}else{t=[]}return t.slice(0,a.get("maxItemCount"))};i.render();e._bindComboBoxEvents()},_buildDataSourceCfg:function(){var e=this.get("sugConfig"),a=this.get("dataSourceCfg");a.xhrCfg.url=e.url;a.parse=S.bind(this._parse,this);return a},_parse:function(e,a){var t=this.fire("beforeParse",{data:a,query:e});if(t===false){return null}else if(t){a=t}return a},_bindComboBoxEvents:function(){var e=this,a=this.get("templates"),t=this.get("log"),r=function(r){var i=D.children(r),s=D.attr(i,"data-tpl"),n=a[s],o=S.unparam(D.attr(i,"data-params")||""),u=S.merge(e.get("options"),{$query:S.escapeHTML(e.curQuery),$pageType:t.pageType,$index:D.attr(i,"data-index")||"1",$isMobile:t.isMobile});n&&e.clicklog((n["genAtpanel"]||function(e,a){return S.substitute(n.atpanel,a)})(i,S.merge(u,o)))};this.comboBox.on("click",function(a){var t=a.target;if(/MyIE/i.test(navigator.userAgent)){if(!a._elItem)return;else{t.set("el",a._elItem)}}if(t&&t.get("el")&&t.get("el")[0]&&D.get(".s-mi-ship",t.get("el")[0])){r(t.get("el"));location.href=D.attr(D.get(".s-mi-ship .s-mi-ship-wrap",t.get("el")[0]),"data-url");return}if(t&&(t.get("el").hasClass(".s-hqHd-menuitem")||t.get("el").hasClass(".s-hyHd-menuitem")||t.get("el").hasClass(".s-loginHd-menuitem"))){return}if(t&&t.get("el")[0]&&D.get(".s-mi-meetingPC",t.get("el")[0])){return}if(e.fire("itemClick",{activeitem:t})!==false){var i=this.get("form"),s=t.get("el");var n=D.attr(D.children(s),"data-params")||"q="+e.query;n=S.merge(this.get("sugConfig").extraParams,S.unparam(n));this.filterFormParams(n);r(s);i.fire("submit",{ignoreClicklog:1})}},this)},filterFormParams:function(e){var a=new RegExp("windows phone|windowsphone","i");var t=navigator.userAgent||"";var r,i,s,n;if(!a.test(t)){for(r=0,i=this.get("form")[0],s=i.elements,n=s.length;r<n;r++){s[r].type==="hidden"&&s[r].name&&D.attr(s[r],"disabled","disabled")}}this.modifyFormParams(e,1)},modifyFormParams:function(params,forceEnable){var form=this.get("form")[0];for(var k in params){if(!params.hasOwnProperty(k)){continue}params[k]=params[k]||"";if(form[k]&&form[k].tagName==="INPUT"){if(params[k].indexOf(VALUE)>-1){if(params[k]!==VALUE){D.val(form[k],eval(params[k].replace(VALUE,form[k].value)))}}else{D.val(form[k],params[k])}Node.one(form[k]).fire("valuechange");forceEnable==1&&D.removeAttr(form[k],"disabled")}else{var value=params[k];if(params[k].indexOf(VALUE)>-1){if(params[k]!==VALUE){value=eval(params[k].replace(VALUE,""))}else{value=""}}D.append(D.create('<input type="hidden" name="'+k+'" value="'+S.escapeHTML(value)+'"/>'),form)}}},_bindSubmitEvent:function(){var e=this,a=e.get("form"),t=e.get("input"),r=e.get("button"),i=e.get("dim"),s=e.get("log"),n=e.get("sugConfig").extraParams,o=e.get("acceptCharset");a.on("submit",function(a){var r=e.fire("beforeSubmit");if(r===false){a.halt()}if(!a.ignoreClicklog&&r!==e.IGNORE_CLICK_LOG){e.clicklog(","+t.val()+","+t.val()+","+i+"-,"+s.clickId+",searchbutton,"+s.pageType+","+s.isMobile)}UA&&UA.ie&&o!==UNKNOWN&&(document.charset=o)});function u(){e.filterFormParams(S.merge(n,{type:"p",q:VALUE,from:i+"_1_searchbutton"}))}t.on("keydown",function(e){if(e.keyCode==13){var t=new RegExp("windows phone|windowsphone","i");var r=navigator.userAgent||"";if(t.test(r)){e.preventDefault();E.fire(a,"submit")}else{u()}}});r.on("click",function(e){u()})},_buildComboBoxCfg:function(e){var a=this.get("sugConfig");return{srcNode:this._wrapInput(a.node,a.prefixCls)||"."+a.prefixCls+"combobox",dataSource:e,format:S.bind(this._format,this),focused:!!a.autoFocus,prefixCls:a.prefixCls||"ks-",hasTrigger:false,matchElWidth:!!a.matchElWidth,highlightMatchItem:false,menu:{align:{overflow:{adjustY:0}}},cache:true,placeholder:a.placeholder||TIP}},_wrapInput:function(e,a){var t=this.get("sugConfig"),r=t.enableSpeech;D.attr(e,S.merge({"class":a+"combobox-input",autocomplete:"off",role:"combobox","aria-haspopup":"true",title:TIP,"aria-label":TIP},r?{"x-webkit-speech":"","x-webkit-grammar":"builtin:translate"}:{}));var i=D.parent(e,".{cls}combobox".replace(/{cls}/g,a)),s=S.guid(a+"combobox-"),n;if(i){i.id=i.id||s;n=Node.one(i)}else{D.wrap(e,D.create('<div id="'+s+'" class="{cls}combobox"><div class="{cls}combobox-input-wrap"></div></div>'.replace(/{cls}/g,a)));n=Node.one("#"+s)}return n},_loadConfig:function(){var e=this;S.ready(function(){setTimeout(function(){IO({url:"//pages.tmall.com/wow/list/act/search-act",dataType:"jsonp",scriptCharset:"utf-8",jsonpCallback:"Jsonp_fixed_searchbar_act",success:function(a){var t=e.get("templates").act;if(t){t.text=a.text||"";t.promo=typeof a.promo=="undefined"?"49218":a.promo}e&&e.fire("configInit",{data:a})}})},0)});return true},_format:function(e,a){if(!a)return[];var t=this.get("templates"),r=this.get("dim"),i=[],s=this._getDate(),n=this.get("sugConfig").prefixCls,o={$wq:S.escapeHTML(e),$query:S.escapeHTML(e),$index:0,$date:s,$prefixCls:n,$dim:r,$userId:a["shop_info"]&&a["shop_info"][0]&&a["shop_info"][0]["user_id"]||""};this.set("options",o);for(var u in t){if(!t[u]){delete t[u];continue}S.log("searchbar::to parse template:"+u+"...");t[u].parse(i,a,S.clone(o))}return i},_getDate:function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+(e.getDate()+1)},update:function(e){var a=this.get("plugins");for(var t=0,r=a.length,i;t<r;t++){i=a[t];i&&S.isFunction(i.update)&&i.update(e)}},blur:function(){var e=this.get("input");e[0].blur()},clicklog:function(e){var a=e.split(","),t=win.__header_atpanel_param||"",r={pos:a[0]||"",q:a[1]||"",wq:a[2]||"",suggest:a[3]||"",clickid:a[4]||"",combo:a[5]||"",page_type:a[6]||"",is_wap:a[7]||"0",type:a[8]||5,active:"0",search_type:"search"};t+=(S.endsWith(t,"&")?"":t?"&":"")+S.param(r);this.exposelog("/mallsearch","tmallsearch",t,"H1449172242")},exposelog:function(e,a,t,r){if(win.goldlog&&win.goldlog.record){goldlog.record(e,a,t,r)}else{var i=new Image,s="_img_"+e+"_"+(new Date).getTime();win[s]=i;i.onload=i.onerror=function(){win[s]=null};i.src="//gm.mmstat.com"+e+"?goldlog=undefined"+"&cache="+makeCacheNum()+"&gmkey="+encodeURIComponent(a)+"&gokey="+encodeURIComponent(t)+"&cna="+(Cookie.get("cna")||"");S.log(win[s]);i=null}},_other:function(){var e=this,a=this.get("ignoreChars"),t=new RegExp("["+a.join(",")+"]","gi"),r=this.get("input"),i=this.comboBox,s=this.get("sugConfig"),n=s.autoExpand,o=s.prefixCls;var u=this.get("query");if(u!==UNKNOWN){r.attr("value",u);i.set("value",u)}r.on("keyup",function(e){e.shiftKey&&(e.keyCode<37&&e.keyCode!==16||e.keyCode>40)&&(this.value=this.value.replace(t,""))});n&&r.on("focus",function(){i.sendRequest(S.trim(this.value))});Node.one(window).on("resize",S.buffer(function(a){var t=e.get("menuContainer");t&&t.width(r.outerWidth())},150));var c=this.get("acceptCharset"),l=this.get("form");c!==UNKNOWN&&l.attr("accept-charset",c);var m=s["autoSubmitOnItemClick"];!m&&this.on("itemClick",function(){return false});i.on("afterCollapsedChange",function(a){if(!a.newVal){i.detach("afterCollapsedChange",arguments.callee);if(/MyIE/i.test(navigator.userAgent)){E.delegate(D.get(".s-menu"),"click",".s-menuitem",function(a){e.comboBox.fire("click",{_elItem:S.one(a.currentTarget)})})}}});r.on("valuechange",function(){e.curQuery=r.val()});e.curQuery=r.val()},_event:["beforeSubmit","beforeParse","beforeQueryChange","itemClick","restore","configInit"],VALUE:VALUE,IGNORE_CLICK_LOG:"{{ignore_click_log}}",UNKNOWN:UNKNOWN},{ATTRS:{sugConfig:{value:{extraParams:{},url:"",node:"",autoFocus:false,autoExpand:false,prefixCls:"s-",placeholder:TIP,enableSpeech:true,matchElWidth:true,autoSubmitOnItemClick:true},setter:function(e){var a=this.get("sugConfig");return S.mix(a,e,undefined,undefined,true)}},templates:{value:{},setter:function(e){return e}},nodes:{value:{}},placeholder:{getter:function(){var e=this.get("nodes");if(!e.placeholder){e.placeholder=this.comboBox.get("placeholderEl")}return e.placeholder}},input:{getter:function(){var e=this.get("nodes");if(!e.input){e.input=this.comboBox.get("input")}return e.input}},button:{getter:function(){var e=this,a=this.get("nodes");if(typeof a.button==="undefined"){var t=this.get("form");var r=t[0].elements;S.each(r,function(a){if(D.attr(a,"type")==="submit"){e.get("nodes").button=Node.one(a)}})}!a.button&&S.log("searchbar::there isn't a button of 'submit' type in this form!","error");return a.button}},form:{getter:function(e){var a=this.get("nodes");if(!a.form){a.form=this.get("input").parent("form")}return a.form}},container:{getter:function(){var e=this.get("nodes");if(!e.container){e.container=this.comboBox.get("el")}return e.container}},menuContainer:{getter:function(){var e=this.get("nodes");if(!e.menuContainer){var a=this.get("menu");a&&a.get&&(e.menuContainer=a.get("el"))}!e.menuContainer&&S.log("searchbar::at so far, popup menu for suggest is nonexistent.","warn");return e.menuContainer}},menu:{getter:function(){return this.comboBox.get("menu")}},dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:true,paramName:"q",cache:true}},dim:{value:".list.pc"},log:{value:{pageType:"1",clickId:"topsearch",isMobile:0},setter:function(e){var a=this.get("log");a=S.mix(a,e,undefined,undefined,true);a.isMobile=a.isMobile?1:0;return a}},ignoreChars:{value:["<",">","?","\uff1f"]},acceptCharset:{value:UNKNOWN},query:{value:UNKNOWN,setter:function(e){if(e){var a=this.get("ignoreChars"),t=new RegExp("["+a.join(",")+"]","gi");e=e.replace(t,"")}else{e=""}return e}}}});SearchBar.UNKNOWN=UNKNOWN;SearchBar.VALUE=VALUE;SearchBar.IGNORE_CLICK_LOG="{{ignore_click_log}}";return SearchBar},{requires:["node","rich-base","dom","combobox","ua","cookie","event","io"]});/*
Copyright 2013, KISSY v1.42
MIT Licensed
build time: Dec 4 22:04
*/
KISSY.add("combobox/combobox-xtpl",[],function(){return function(f){var a,d=this;a=this.config.utils;var j=a.runBlockCommand,k=a.renderOutput,g=a.getProperty,h=a.runInlineCommand,e=a.getPropertyOrRunCommand;a='<div id="ks-combobox-invalid-el-';var b=e(d,f,{},"id",0,1);a+=k(b,!0);a+='"\n     class="';var b={},c=[];c.push("invalid-el");b.params=c;b=h(d,f,b,"getBaseCssClasses",2);a+=k(b,!0);a+='">\n    <div class="';b={};c=[];c.push("invalid-inner");b.params=c;b=h(d,f,b,"getBaseCssClasses",3);a+=k(b,
!0);a+='"></div>\n</div>\n\n';var b={},c=[],m=g(d,f,"hasTrigger",0,6);c.push(m);b.params=c;b.fn=function(b){var a;a='\n<div id="ks-combobox-trigger-';var c=e(d,b,{},"id",0,7);a+=k(c,!0);a+='"\n     class="';var c={},g=[];g.push("trigger");c.params=g;c=h(d,b,c,"getBaseCssClasses",8);a+=k(c,!0);a+='">\n    <div class="';c={};g=[];g.push("trigger-inner");c.params=g;b=h(d,b,c,"getBaseCssClasses",9);a+=k(b,!0);return a+'">&#x25BC;</div>\n</div>\n'};a+=j(d,f,b,"if",6);a+='\n\n<div class="';b={};c=[];c.push("input-wrap");
b.params=c;b=h(d,f,b,"getBaseCssClasses",13);a+=k(b,!0);a+='">\n\n    <input id="ks-combobox-input-';b=e(d,f,{},"id",0,15);a+=k(b,!0);a+='"\n           aria-haspopup="true"\n           aria-autocomplete="list"\n           aria-haspopup="true"\n           role="autocomplete"\n           aria-expanded="false"\n\n    ';b={};c=[];m=g(d,f,"disabled",0,22);c.push(m);b.params=c;b.fn=function(){return"\n    disabled\n    "};a+=j(d,f,b,"if",22);a+='\n\n    autocomplete="off"\n    class="';b={};c=[];c.push("input");
b.params=c;b=h(d,f,b,"getBaseCssClasses",27);a+=k(b,!0);a+='"\n\n    value="';b=e(d,f,{},"value",0,29);a+=k(b,!0);a+='"\n    />\n\n\n    <label id="ks-combobox-placeholder-';b=e(d,f,{},"id",0,33);a+=k(b,!0);a+='"\n           for="ks-combobox-input-';b=e(d,f,{},"id",0,34);a+=k(b,!0);a+="\"\n            style='display:";b={};c=[];g=g(d,f,"value",0,35);c.push(g);b.params=c;b.fn=function(){return"none"};b.inverse=function(){return"block"};a+=j(d,f,b,"if",35);a+=";'\n    class=\"";j={};g=[];g.push("placeholder");
j.params=g;j=h(d,f,j,"getBaseCssClasses",36);a+=k(j,!0);a+='">\n    ';f=e(d,f,{},"placeholder",0,37);a+=k(f,!0);return a+"\n    </label>\n</div>\n"}});
KISSY.add("combobox/render",["component/control","./combobox-xtpl"],function(f,a){var d=a("component/control"),j=a("./combobox-xtpl");return d.getDefaultRender().extend({beforeCreateDom:function(a,d){f.mix(d,{input:"#ks-combobox-input-{id}",trigger:"#ks-combobox-trigger-{id}",invalidEl:"#ks-combobox-invalid-el-{id}",placeholderEl:"#ks-combobox-placeholder-{id}"})},getKeyEventTarget:function(){return this.control.get("input")},_onSetCollapsed:function(a){this.control.get("input").attr("aria-expanded",
!a)},_onSetDisabled:function(a,d){this.callSuper(a,d);this.control.get("input").attr("disabled",a)}},{ATTRS:{contentTpl:{value:j}},HTML_PARSER:{value:function(a){return a.one("."+this.getBaseCssClass("input")).val()},input:function(a){return a.one("."+this.getBaseCssClass("input"))},trigger:function(a){return a.one("."+this.getBaseCssClass("trigger"))},invalidEl:function(a){return a.one("."+this.getBaseCssClass("invalid-el"))},placeholderEl:function(a){return a.one("."+this.getBaseCssClass("placeholder"))}}})});
KISSY.add("combobox/control",["node","component/control","./render","menu"],function(f,a){function d(a){for(var b=0;b<a.length;b++)if(!a[b].get("disabled"))return a[b];return null}function j(){c(this)}function k(){var a=this;setTimeout(function(){m(a)},0)}function g(){this.focus();m(this)}function h(){this.setValueFromAutocomplete(this.getValueForAutocomplete(),{force:1})}function e(a){a=a.target;a.isMenuItem&&(a=a.get("textContent"),this.setValueFromAutocomplete(a),this._savedValue=a,this.set("collapsed",
!0))}function b(a,b){var c=a.$el,e=a.view.getBaseCssClasses("invalid"),d=a.get("invalidEl");b?(c.addClass(e),d.attr("title",b),d.show()):(c.removeClass(e),d.hide())}function c(a){a._focusoutDismissTimer||(a._focusoutDismissTimer=setTimeout(function(){a._focusoutDismissTimer&&a.set("collapsed",!0)},50))}function m(a){var b=a._focusoutDismissTimer;b&&(clearTimeout(b),a._focusoutDismissTimer=null)}function s(a){this.set("value",a.newVal,{data:{causedByTimer:1}})}function i(a){var b,c=[],e,d,c=this.get("menu"),
a=this.normalizeData(a);c.removeChildren(!0);(d=c.get("highlightedItem"))&&d.set("highlighted",!1);if(a&&a.length){for(d=0;d<a.length;d++)b=a[d],c.addChild(b);c=c.get("children");a=this.getValueForAutocomplete();if(this.get("highlightMatchItem"))for(d=0;d<c.length;d++)if(c[d].get("textContent")===a){c[d].set("highlighted",!0);e=!0;break}if(!e&&this.get("autoHighlightFirst"))for(d=0;d<c.length;d++)if(!c[d].get("disabled")){c[d].set("highlighted",!0);break}this.set("collapsed",!1);this.fire("afterRenderData")}else this.set("collapsed",
!0)}var t=a("node"),p=a("component/control"),o=a("./render");a("menu");var l=t.KeyCode;return p.extend([],{initializer:function(){this.publish("afterRenderData",{bubbles:!1})},_savedValue:null,normalizeData:function(a){var b,c,d;if(a&&a.length){a=a.slice(0,this.get("maxItemCount"));b=this.get("format")?this.get("format").call(this,this.getValueForAutocomplete(),a):[];for(d=0;d<a.length;d++)c=a[d],b[d]=f.mix({content:c,textContent:c,value:c},b[d])}return b},bindUI:function(){var a=this;a.get("input").on("valuechange",
s,a);a.on("click",e,a);a.get("menu").onRendered(function(b){var c=a.get("input"),d=b.get("el"),b=b.get("contentEl");c.attr("aria-owns",d.attr("id"));d.on("focusout",j,a);d.on("focusin",k,a);b.on("mouseover",g,a);b.on("mousedown",h,a)})},destructor:function(){this.get("menu").destroy()},getValueForAutocomplete:function(){return this.get("value")},setValueFromAutocomplete:function(a,b){this.set("value",a,b)},_onSetValue:function(a,b){var c;b.causedByTimer?(c=this.getValueForAutocomplete(),void 0===
c?this.set("collapsed",!0):(this._savedValue=c,this.sendRequest(c))):this.get("input").val(a)},handleFocusInternal:function(){var a;this.get("invalidEl")&&b(this,!1);(a=this.get("placeholderEl"))&&a.hide()},handleBlurInternal:function(a){var d=this,e=d.get("placeholderEl");d.callSuper(a);c(d);d.get("invalidEl")&&d.validate(function(a,c){a?!d.get("focused")&&c===d.get("value")&&b(d,a):b(d,!1)});e&&!d.get("value")&&e.show()},handleMouseDownInternal:function(a){var b,c;this.callSuper(a);b=a.target;if((c=
this.get("trigger"))&&(c[0]===b||c.contains(b)))this.get("collapsed")?(this.focus(),this.sendRequest("")):this.set("collapsed",!0),a.preventDefault()},handleKeyDownInternal:function(a){var b,c=a.keyCode,e,g,h=this.get("menu");this.get("input");b=this.get("updateInputOnDownUp");if(h.get("visible")){e=h.get("highlightedItem");if(b&&e&&(g=h.get("children"),c===l.DOWN&&e===d(g.concat().reverse())||c===l.UP&&e===d(g)))return this.setValueFromAutocomplete(this._savedValue),e.set("highlighted",!1),!0;g=
h.handleKeyDownInternal(a);e=h.get("highlightedItem");if(c===l.ESC)return this.set("collapsed",!0),b&&this.setValueFromAutocomplete(this._savedValue),!0;b&&f.inArray(c,[l.DOWN,l.UP])&&this.setValueFromAutocomplete(e.get("textContent"));return c===l.TAB&&e&&(e.handleClickInternal(a),this.get("multiple"))?!0:g}if(c===l.DOWN||c===l.UP)if(a=this.getValueForAutocomplete(),void 0!==a)return this.sendRequest(a),!0},validate:function(a){var b=this.get("validator"),c=this.getValueForAutocomplete();b?b(c,function(b){a(b,
c)}):a(!1,c)},sendRequest:function(a){this.get("dataSource").fetchData(a,i,this)},_onSetCollapsed:function(a){var b=this.$el,c=this.get("menu");a?c.hide():(m(this),c.get("visible")||(this.get("matchElWidth")&&(c.render(),a=c.get("el"),a=(parseInt(a.css("borderLeftWidth"))||0)+(parseInt(a.css("borderRightWidth"))||0),c.set("width",b[0].offsetWidth-a)),c.show()))}},{ATTRS:{input:{},value:{value:"",sync:0,view:1},trigger:{},placeholder:{view:1},placeholderEl:{},validator:{},invalidEl:{},allowTextSelection:{value:!0},
hasTrigger:{value:!0,view:1},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){if(a.isControl){a.setInternal("parent",this);var b={node:this.$el,points:["bl","tl"],overflow:{adjustX:1,adjustY:1}};f.mix(a.get("align"),b,!1)}}},collapsed:{view:1,value:!0},dataSource:{},maxItemCount:{value:99999},matchElWidth:{value:!0},format:{},updateInputOnDownUp:{value:!0},autoHighlightFirst:{},highlightMatchItem:{value:!0},
xrender:{value:o}},xclass:"combobox"})});
KISSY.add("combobox/cursor",["node"],function(f,a){function d(a){var b=g;b||(b=j(k));"textarea"===""+a[0].type.toLowerCase()?b.css("width",a.css("width")):b.css("width",9999);f.each(h,function(c){b.css(c,a.css(c))});g||b.insertBefore(a[0].ownerDocument.body.firstChild);return g=b}var j=a("node").all,k='<div style="z-index:-9999;overflow:hidden;position: fixed;left:-9999px;top:-9999px;opacity:0;white-space:pre-wrap;word-wrap:break-word;"></div>',g,h="paddingLeft,paddingTop,paddingBottom,paddingRight,marginLeft,marginTop,marginBottom,marginRight,borderLeftStyle,borderTopStyle,borderBottomStyle,borderRightStyle,borderLeftWidth,borderTopWidth,borderBottomWidth,borderRightWidth,line-height,outline,height,fontFamily,fontSize,fontWeight,fontVariant,fontStyle".split(",");return function(a){var b=
j(a),a=b[0],c=a.ownerDocument,g=j(c),h=a.scrollTop,i=a.scrollLeft;if(c.selection)return a=c.selection.createRange(),{left:a.boundingLeft+i+g.scrollLeft(),top:a.boundingTop+h+a.boundingHeight+g.scrollTop()};g=b.offset();if("textarea"!==a.type)return g.top+=a.offsetHeight,g;c=d(b);b=a.selectionStart;c.html(f.escapeHtml(a.value.substring(0,b-1))+"<span>x</span>");c.offset(g);g=c.last();a=g.offset();a.top+=g.height();0<b&&(a.left+=g.width());a.top-=h;a.left-=i;return a}});
KISSY.add("combobox/multi-value-combobox",["./cursor","./control"],function(f,a){function d(a,c){return c&&-1!==a.indexOf(c)}function j(a){a.newVal&&a.target===this.get("menu")&&this.alignWithCursor()}function k(a){var c=a.get("input"),e=a.get("value"),f=[],i=[],k=a.get("literal"),j=a.get("separator"),a=a.get("separatorType"),o=!1,l=a!==g,c=c.prop("selectionStart"),q,n,r=-1;for(q=0;q<e.length;q++)(n=e.charAt(q),k&&n===k&&(o=!o),o)?i.push(n):(q===c&&(r=f.length),l&&h.test(n))?(i.length&&f.push(i.join("")),
i=[],i.push(n)):d(j,n)?a===g?(i.push(n),i.length&&f.push(i.join("")),i=[]):(i.length&&f.push(i.join("")),i=[],i.push(n)):i.push(n);i.length&&f.push(i.join(""));f.length||f.push("");-1===r&&(a===g&&d(j,n)&&f.push(""),r=f.length-1);return{tokens:f,cursorPosition:c,tokenIndex:r}}var g="suffix",h=/\s|\xa0/,e=a("./cursor");return a("./control").extend({syncUI:function(){var a;this.get("alignWithCursor")&&(a=this.get("menu"),a.setInternal("align",null),a.on("beforeVisibleChange",j,this))},getValueForAutocomplete:function(){var a=
k(this),c=a.tokens,h=a.tokenIndex,a=this.get("separator"),f=this.get("separatorType"),c=c[h],h=c.length-1;if(f!==g)if(d(a,c.charAt(0)))c=c.slice(1);else return;else f===g&&d(a,c.charAt(h))&&(c=c.slice(0,h));return c},setValueFromAutocomplete:function(a,c){var f=this.get("input"),e=k(this),i=e.tokens,e=Math.max(0,e.tokenIndex),j=this.get("separator"),p;p=this.get("separatorType");var o=i[e+1]||"",l=i[e];if(p!==g){if(i[e]=l.charAt(0)+a,a&&(!o||!h.test(o.charAt(0))))i[e]+=" "}else i[e]=a,p=l.length-
1,d(j,l.charAt(p))?i[e]+=l.charAt(p):1===j.length&&(i[e]+=j);e=i.slice(0,e+1).join("").length;this.set("value",i.join(""),c);f.prop("selectionStart",e);f.prop("selectionEnd",e)},alignWithCursor:function(){var a=this.get("menu"),c;c=this.get("input");c=e(c);a.move(c.left,c.top)}},{ATTRS:{separator:{value:",;"},separatorType:{value:g},literal:{value:'"'},alignWithCursor:{}},xclass:"multi-value-combobox"})});
KISSY.add("combobox/filter-select",["./control"],function(f,a,d,j){f=a("./control");j.exports=f.extend({validate:function(a){var d=this;d.callSuper(function(h,e){h?a(h,e):d.get("dataSource").fetchData(e,function(b){a:{if(b=d.normalizeData(b))for(var c=0;c<b.length;c++)if(b[c].textContent===e){b=b[c];break a}b=!1}a(b?"":d.get("invalidMessage"),e,b)})})}},{ATTRS:{invalidMessage:{value:"invalid input"}}})});
KISSY.add("combobox/local-data-source",["attribute"],function(f,a){return a("attribute").extend({fetchData:function(a,f,k){var g=this.get("parse"),h=this.get("data"),h=g(a,h);f.call(k,h)}},{ATTRS:{data:{value:[]},parse:{value:function(a,j){var k=[],g=0;if(!a)return j;f.each(j,function(f){-1!==f.indexOf(a)&&k.push(f);g++});return k}}}})});
KISSY.add("combobox/remote-data-source",["io","attribute"],function(f,a){var d=a("io");return a("attribute").extend({fetchData:function(a,f,g){var h=this,e,b=h.get("paramName"),c=h.get("parse"),m=h.get("cache"),s=h.get("allowEmpty");h.caches=h.caches||{};h.io&&(h.io.abort(),h.io=null);if(!a&&!0!==s)return f.call(g,[]);if(m&&(e=h.caches[a]))return f.call(g,e);e=h.get("xhrCfg");e.data=e.data||{};e.data[b]=a;e.success=function(b){c&&(b=c(a,b));h.setInternal("data",b);m&&(h.caches[a]=b);f.call(g,b)};
h.io=d(e)}},{ATTRS:{paramName:{value:"q"},allowEmpty:{},cache:{},parse:{},xhrCfg:{value:{}}}})});
KISSY.add("combobox",["combobox/control","combobox/multi-value-combobox","combobox/filter-select","combobox/local-data-source","combobox/remote-data-source"],function(f,a){var d=a("combobox/control"),j=a("combobox/multi-value-combobox"),k=a("combobox/filter-select"),g=a("combobox/local-data-source"),h=a("combobox/remote-data-source");d.LocalDataSource=g;d.RemoteDataSource=h;d.FilterSelect=k;d.MultiValueComboBox=j;return d});
/*
Copyright 2013, KISSY v1.42
MIT Licensed
build time: Dec 4 22:16
*/
KISSY.add("menu/menu-render",["component/container"],function(e,a){return a("component/container").getDefaultRender().extend({beforeCreateDom:function(a){a.elAttrs.role="menu"},containsElement:function(a){var c=this.$el;return c&&(c[0]===a||c.contains(a))}})});
KISSY.add("menu/control",["node","component/container","component/extension/delegate-children","./menu-render"],function(e,a){function b(a){a.target.isMenu&&(a=a.newVal,this.el.setAttribute("aria-activedescendant",a&&a.el.id||""))}var c=a("node"),h=a("component/container"),d=a("component/extension/delegate-children"),g=a("./menu-render"),i=c.KeyCode;return h.extend([d],{isMenu:1,_onSetHighlightedItem:function(a,f){var d;a&&f&&(d=f.prevVal)&&d.set("highlighted",!1,{data:{byPassSetHighlightedItem:1}})},
_onSetVisible:function(a,f){this.callSuper(f);var d;!a&&(d=this.get("highlightedItem"))&&d.set("highlighted",!1)},bindUI:function(){this.on("afterHighlightedItemChange",b,this)},getRootMenu:function(){return this},handleMouseEnterInternal:function(a){this.callSuper(a);if((a=this.getRootMenu())&&a._popupAutoHideTimer)clearTimeout(a._popupAutoHideTimer),a._popupAutoHideTimer=null;this.focus()},handleBlurInternal:function(a){this.callSuper(a);var f;(f=this.get("highlightedItem"))&&f.set("highlighted",
!1)},_getNextEnabledHighlighted:function(a,f){var d=this.get("children"),b=d.length,c=a;do{var g=d[a];if(!g.get("disabled")&&!1!==g.get("visible"))return d[a];a=(a+f+b)%b}while(a!==c)},handleKeyDownInternal:function(a){var f=this.get("highlightedItem");if(f&&f.handleKeyDownInternal(a))return!0;var d=this.get("children"),b=d.length;if(0!==b){var c;switch(a.keyCode){case i.ESC:(f=this.get("highlightedItem"))&&f.set("highlighted",!1);break;case i.HOME:c=this._getNextEnabledHighlighted(0,1);break;case i.END:c=
this._getNextEnabledHighlighted(b-1,-1);break;case i.UP:f?(a=e.indexOf(f,d),b=(a-1+b)%b):b-=1;c=this._getNextEnabledHighlighted(b,-1);break;case i.DOWN:f?(a=e.indexOf(f,d),b=(a+1+b)%b):b=0,c=this._getNextEnabledHighlighted(b,1)}if(c)return c.set("highlighted",!0,{data:{fromKeyboard:1}}),!0}},containsElement:function(a){if(!this.get("visible")||!this.$el)return!1;if(this.view.containsElement(a))return!0;for(var f=this.get("children"),b=0,d=f.length;b<d;b++){var c=f[b];if(c.containsElement&&c.containsElement(a))return!0}return!1}},
{ATTRS:{highlightedItem:{value:null},xrender:{value:g},defaultChildCfg:{value:{xclass:"menuitem"}}},xclass:"menu"})});
KISSY.add("menu/menuitem-render",["component/control"],function(e,a){return a("component/control").getDefaultRender().extend({beforeCreateDom:function(a){a.elAttrs.role=a.selectable?"menuitemradio":"menuitem";a.selected&&a.elCls.push(this.getBaseCssClasses("selected"))},_onSetSelected:function(a){var c=this.getBaseCssClasses("selected");this.$el[a?"addClass":"removeClass"](c)},containsElement:function(a){var c=this.$el;return c&&(c[0]===a||c.contains(a))}},{HTML_PARSER:{selectable:function(a){return a.hasClass(this.getBaseCssClass("selectable"))}}})});
KISSY.add("menu/menuitem",["component/control","./menuitem-render","node"],function(e,a){var b=a("component/control"),c=a("./menuitem-render"),h=a("node").all;return b.extend({isMenuItem:1,handleClickInternal:function(){this.callSuper();this.get("selectable")&&this.set("selected",!0);this.fire("click");return!0},_onSetHighlighted:function(a,c){var b=this.get("parent");if(!c||!c.byPassSetHighlightedItem)this.get("rendered")?b.set("highlightedItem",a?this:null):a&&b.set("highlightedItem",this);if(a){var e=
this.$el;(b=e.parent(function(a){return"visible"!==h(a).css("overflow")},b.get("el").parent()))&&e.scrollIntoView(b,{alignWithTop:!0,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})}},containsElement:function(a){return this.view.containsElement(a)}},{ATTRS:{focusable:{value:!1},handleMouseEvents:{value:!1},selectable:{view:1},value:{},selected:{view:1},xrender:{value:c}},xclass:"menuitem"})});
KISSY.add("menu/check-menuitem-xtpl",["component/extension/content-xtpl"],function(e,a,b,c){return function(b){var d,g;d=this.config.utils;"undefined"!==typeof c&&c.kissy&&(g=c);var e=d.renderOutput,j=d.runInlineCommand;d='<div class="';var f={},k=[];k.push("checkbox");f.params=k;f=j(this,b,f,"getBaseCssClasses",1);d+=e(f,!0);d+='">\n</div>\n';f={};k=[];k.push("component/extension/content-xtpl");f.params=k;g&&(a("component/extension/content-xtpl"),f.params[0]=g.resolveByName(f.params[0]));b=j(this,
b,f,"include",3);return d+=e(b,!1)}});KISSY.add("menu/check-menuitem-render",["./menuitem-render","component/extension/content-render","./check-menuitem-xtpl"],function(e,a){var b=a("./menuitem-render"),c=a("component/extension/content-render"),h=a("./check-menuitem-xtpl");return b.extend([c],{beforeCreateDom:function(a){a.checked&&a.elCls.push(this.getBaseCssClasses("checked"))},_onSetChecked:function(a){var b=this.getBaseCssClasses("checked");this.$el[a?"addClass":"removeClass"](b)}},{ATTRS:{contentTpl:{value:h}}})});
KISSY.add("menu/check-menuitem",["./menuitem","./check-menuitem-render"],function(e,a){var b=a("./menuitem"),c=a("./check-menuitem-render");return b.extend({handleClickInternal:function(){this.callSuper();this.set("checked",!this.get("checked"));this.fire("click");return!0}},{ATTRS:{checked:{view:1},xrender:{value:c}},xclass:"check-menuitem"})});
KISSY.add("menu/submenu-xtpl",[],function(){return function(e){var a;a=this.config.utils;var b=a.renderOutput,c=a.runInlineCommand,h=a.getPropertyOrRunCommand;a='<div id="ks-content-';var d=h(this,e,{},"id",0,1);a+=b(d,!0);a+='"\n     class="';var d={},g=[];g.push("content");d.params=g;c=c(this,e,d,"getBaseCssClasses",2);a+=b(c,!0);a+='">';c=h(this,e,{},"content",0,2);a+=b(c,!1);a+='</div>\n<span class="';e=h(this,e,{},"prefixCls",0,3);a+=b(e,!0);return a+'submenu-arrow">\u25ba</span>'}});
KISSY.add("menu/submenu-render",["./submenu-xtpl","./menuitem-render","component/extension/content-render"],function(e,a){var b=a("./submenu-xtpl"),c=a("./menuitem-render"),h=a("component/extension/content-render");return c.extend([h],{decorateDom:function(a){var b=this.control,c=b.get("prefixCls"),a=a.one("."+c+"popupmenu"),e=a[0].ownerDocument.body;e.insertBefore(a[0],e.firstChild);e=this.getComponentConstructorByNode(c,a);b.setInternal("menu",new e({srcNode:a,prefixCls:c}))}},{ATTRS:{contentTpl:{value:b}}})});
KISSY.add("menu/submenu",["node","./menuitem","./submenu-render"],function(e,a){function b(a){var b=a.target;b!==this&&b.isMenuItem&&a.newVal&&(this.clearHidePopupMenuTimers(),this.get("highlighted")||(this.set("highlighted",!0),b.set("highlighted",!1),b.set("highlighted",!0)))}function c(){var a=this.get("menu"),b={node:this.$el,points:["tr","tl"],overflow:{adjustX:1,adjustY:1}};e.mix(a.get("align"),b,!1);a.show();this.el.setAttribute("aria-haspopup",a.get("el").attr("id"))}function h(){this.get("menu").hide()}
var d=a("node"),g=a("./menuitem"),i=a("./submenu-render"),j=d.KeyCode;return g.extend({isSubMenu:1,clearShowPopupMenuTimers:function(){var a;if(a=this._showTimer)a.cancel(),this._showTimer=null},clearHidePopupMenuTimers:function(){var a;if(a=this._dismissTimer)a.cancel(),this._dismissTimer=null},clearSubMenuTimers:function(){this.clearHidePopupMenuTimers();this.clearShowPopupMenuTimers()},bindUI:function(){this.on("afterHighlightedChange",b,this)},handleMouseLeaveInternal:function(){this.set("highlighted",
!1,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")&&(this._dismissTimer=e.later(h,1E3*this.get("menuDelay"),!1,this))},handleMouseEnterInternal:function(){this.set("highlighted",!0,{data:{fromMouse:1}});this.clearSubMenuTimers();this.get("menu").get("visible")||(this._showTimer=e.later(c,1E3*this.get("menuDelay"),!1,this))},_onSetHighlighted:function(a,b){b&&(this.callSuper(b),b.fromMouse||(a&&!b.fromKeyboard?c.call(this):a||h.call(this)))},handleClickInternal:function(){c.call(this);
this.callSuper()},handleKeyDownInternal:function(a){var b=this.get("menu"),d,e=b.get("visible"),g=a.keyCode;if(e){if(!b.handleKeyDownInternal(a))if(g===j.LEFT)this.set("highlighted",!1),this.set("highlighted",!0,{data:{fromKeyboard:1}});else return}else if(g===j.RIGHT)c.call(this),a=b.get("children"),(d=a[0])&&d.set("highlighted",!0,{data:{fromKeyboard:1}});else{if(g===j.ENTER)return this.handleClickInternal(a);return}return!0},containsElement:function(a){return this.get("menu").containsElement(a)},
destructor:function(){var a=this.get("menu");this.clearSubMenuTimers();a.destroy()}},{ATTRS:{menuDelay:{value:0.15},menu:{value:{},getter:function(a){a.isControl||(a.xclass=a.xclass||"popupmenu",a=this.createComponent(a),this.setInternal("menu",a));return a},setter:function(a){a.isControl&&a.setInternal("parent",this)}},xrender:{value:i}},xclass:"submenu"})});
KISSY.add("menu/popupmenu-render",["component/extension/content-render","./menu-render"],function(e,a){var b=a("component/extension/content-render");return a("./menu-render").extend([b])});
KISSY.add("menu/popupmenu",["component/extension/align","component/extension/shim","./control","./popupmenu-render"],function(e,a){var b=a("component/extension/align"),c=a("component/extension/shim"),h=a("./control"),d=a("./popupmenu-render");return h.extend([c,b],{getRootMenu:function(){var a=this,b;do b=a,a=a.get("parent");while(a&&(a.isMenuItem||a.isMenu));return b===this?null:b},handleMouseLeaveInternal:function(a){this.callSuper(a);if(this.get("autoHideOnMouseLeave")){var b=this.getRootMenu();
b&&(clearTimeout(b._popupAutoHideTimer),b._popupAutoHideTimer=setTimeout(function(){var a;(a=b.get("highlightedItem"))&&a.set("highlighted",!1)},1E3*this.get("parent").get("menuDelay")))}},isPopupMenu:1,handleBlurInternal:function(a){this.callSuper(a);this.hide()}},{ATTRS:{focusable:{value:!1},autoHideOnMouseLeave:{},contentEl:{},visible:{value:!1},xrender:{value:d}},xclass:"popupmenu"})});
KISSY.add("menu",["menu/control","menu/menuitem","menu/check-menuitem","menu/submenu","menu/popupmenu"],function(e,a){var b=a("menu/control"),c=a("menu/menuitem"),h=a("menu/check-menuitem"),d=a("menu/submenu"),g=a("menu/popupmenu");b.Item=c;b.CheckItem=h;b.SubMenu=d;b.PopupMenu=g;return b});
/*
Copyright 2014, KISSY v1.42
MIT Licensed
build time: Feb 25 15:53
*/
KISSY.add("component/extension/delegate-children",["node","component/manager"],function(d,e){function h(a){a.target===this&&a.component.$el.addClass(this.__childClsTag)}function i(a){a.target===this&&(a=a.component.$el)&&a.removeClass(this.__childClsTag)}function f(){this.__childClsTag=d.guid("ks-component-child");this.on("afterRenderChild",h,this).on("afterRemoveChild",i,this)}var j=e("node"),k=e("component/manager"),g=d.UA.ieMode,c=j.Gesture;d.Features.isTouchEventSupported();d.augment(f,{handleChildrenEvents:function(a){if(!this.get("disabled")){var b=
this.getOwnerControl(a);if(b&&!b.get("disabled"))switch(a.stopPropagation(),a.type){case c.start:b.handleMouseDown(a);break;case c.end:b.handleMouseUp(a);break;case c.tap:b.handleClick(a);break;case "mouseenter":b.handleMouseEnter(a);break;case "mouseleave":b.handleMouseLeave(a);break;case "contextmenu":b.handleContextMenu(a);break;case "dblclick":b.handleDblClick(a);break;default:a.type+" unhandled!"}}},__bindUI:function(){var a=c.start+" "+c.end+" "+c.tap;c.cancel&&(a+=" "+c.cancel);a+=" mouseenter mouseleave contextmenu "+
(g&&9>g?"dblclick ":"");this.$el.delegate(a,"."+this.__childClsTag,this.handleChildrenEvents,this)},getOwnerControl:function(a){return k.getComponent(a.currentTarget.id)}});return f});
KISSY.add("mui/searchbar/plugin/spm",function(e,t,a){var r="data-spm",i="spm-id",n="spm",o="0.0.a2227oh.d100";function s(t){s.superclass.constructor.call(this,e.merge({spm:o},t||{}))}e.extend(s,a,{pluginInitializer:function(e){this.set("caller",e);this.init()},init:function(){var e=this.get("caller");if(!e)return;var t=e.get("sugConfig").extraParams;t[n]=this.get("spm")}},{ATTRS:{pluginId:{value:"spm"},spm:{value:o,setter:function(e){var a=(e.split(".")||[]).reverse(),n={};n.d=a[0]||"0";n.c=a[1]||"0";n.b=a[2]||"0";n.a=a[3]||"0";var o=c(i),s=o?o.content:"";if(!s){o=c(r);s=o?o.content:"";s+="."+(t.attr(document.body,r)||"")}var u=s.split(".")||[];n.a=u[0]||n.a;n.b=u[1]||n.b;return[n.a,n.b,n.c,n.d].join(".")},getter:function(e){var t=(e.split(".")||[]).reverse(),a={};var i=this.get("caller");if(i){var o=i.get("form"),s=o[0][n],c;if(s&&s.tagName==="INPUT"){c=(s.value.split(".")||[]).reverse();t[0]=c[0]||t[0];t[1]=c[1]||t[1]}if(!t[1]&&a.c==="0"){var l=i.get("input"),m=i.get("container");t[1]=m.attr(r)||o.attr(r)||u(l[0])||t[1]}}return t.reverse().join(".")}}}});function u(e){var t;while(e&&e.tagName!="HTML"&&e.tagName!="BODY"&&e.getAttribute){if(t=e.getAttribute(r)){break}if(!(e=e.parentNode)){break}}return t}function c(e){try{return t.get('meta[name="'+e+'"]')}catch(a){var r=t.query("meta"),i="";for(var n=0,o=r.length;n<o;n++){if(r[n].name==e){i=r[n];break}}return i}}return s},{requires:["dom","base"]});KISSY.add("mui/searchbar/plugin/placeholder",function(e,t,a){var r=window;function i(e){this._tasks=[];i.superclass.constructor.call(this,e||{})}e.extend(i,a,{pluginInitializer:function(t){this.set("caller",t);var a=t.get("placeholder");if(!a){var r=this.get("text"),i=t.get("input"),n=t.get("container"),o=i.attr("id"),s=t.get("sugConfig").prefixCls;!o&&i.attr("id",o=e.guid(s+"combobox-input"));t.comboBox.set("placeholderEl",e.all('<label for="'+o+'" class="'+s+'combobox-placeholder">'+r+"</label>").appendTo(n))}this._customizeText();this._customizeInteraction();this._customizeSearch()},_customizeText:function(){var e=this.get("caller"),t=e.comboBox,a=t.get("placeholderEl"),r=this.get("text");a&&a.html(r);t.set("placeholder",r)},_customizeInteraction:function(){var t=this.get("caller"),a=t.get("placeholder"),r=t.get("input"),i=this.get("colors");function n(){e.trim(r.val())===""?a.css({visibility:"visible"}):a.css({display:"none",visibility:"hidden"})}setTimeout(n,100);r.on("valuechange",n);a.css("color",i[1]);if(t.get("sugConfig").autoFocus){a.css("color",i[0])}r.on("focus",function(){a.css("color",i[0]);e.trim(this.value)===""&&a.css({display:"inline",visibility:"visible"})});r.on("blur",function(){e.trim(this.value)===""&&e.trim(r.attr("value"))===""&&a.css({color:i[1],visibility:"visible"})});r.on("keydown",function(t){var r=t.keyCode;if(r==32&&e.trim(this.value)===""){a.css({visibility:"hidden"})}else if(r<13||r>37&&r<112||r>123){a.css({visibility:"hidden"})}});r.on("keyup",function(e){var t=e.keyCode;this.value===""&&!(t==8||t==46)&&a.css({display:"inline",visibility:"visible"})})},_customizeSearch:function(){var a=this,r=this.get("query"),i=this.get("text"),n=this.get("redirectUrl"),o=this.get("xiaoer"),s=this.get("caller"),u=s.get("input"),c=s.get("form"),l=s.get("dim"),h=s.get("log");if(r&&!this._eQueryFn){s.on("beforeSubmit",this._eQueryFn=function(t){if(e.trim(u.val())===""){u.val(a.get("query"));s.modifyFormParams({from:l+"_"+o+"_placeholder"});s.clicklog(","+a.get("query")+","+a.get("query")+","+l+"-,"+h.clickId+",placeholder,"+h.pageType+","+h.isMobile);setTimeout(function(){u.val("")},0);return s.IGNORE_CLICK_LOG}});setTimeout(function(){s.exposelog("/msearch.3.3","searchbar-placeholder","dim="+l+"&q="+r+"&xiaoer="+o,"H46777406")},0)}else if(!r&&this._eQueryFn){s.detach("beforeSubmit",this._eQueryFn);this._eQueryFn=null}if(!r){if(n&&!this._eRedirectFn){if(!c[0]["redirect"])c.append(t.create('<input type="hidden" name="redirect" value="" disabled="disabled" />'));s.on("beforeSubmit",this._eRedirectFn=function(a){if(e.trim(u.val())===""){c[0]["redirect"].value=n;t.removeAttr(c[0]["redirect"],"disabled");s.modifyFormParams({from:l+"_1_placeholder"});s.clicklog(","+n+","+n+","+l+"-,"+h.clickId+",placeholder,"+h.pageType+","+h.isMobile);return s.IGNORE_CLICK_LOG}else{c[0]["redirect"].value="";t.attr(c[0]["redirect"],"disabled","disabled")}});return}else if(!n&&this._eRedirectFn){s.detach("beforeSubmit",this._eRedirectFn);this._eRedirectFn=null}}else{if(this._eRedirectFn){s.detach("beforeSubmit",this._eRedirectFn);this._eRedirectFn=null}}!this._eEmptyFn&&s.on("beforeSubmit",this._eEmptyFn=function(t){if(a._eQueryFn||a._eRedirectFn){s.detach("beforeSubmit",a._eEmptyFn);a._eEmptyFn=null;return}if(e.trim(u.val())===""){a._emptyNotice();return false}})},_reviseUrl:function(e){var t=r.TB&&TB.globalToolFn&&TB.globalToolFn.isDaily&&TB.globalToolFn.isDaily(),a="?spm=0.0.0.0",i=e.indexOf("?"),n=e.indexOf("#"),o=n<0?e.length:n;t&&e.replace(/\b\/\/list.tmall.com\b/,"//list.daily.tmall.net");return i>0?e.replace("?",a+(i==o-1?"":"&")):e+a},_emptyNotice:function(){var e=this.get("caller"),t=e.get("placeholder"),a=e.get("input");if(!a._inFlash){a._inFlash=true;t.html("\u8bf7\u8f93\u5165\u5173\u952e\u5b57");t.css("visibility","visible");this._flashBackground()}},_flashBackground:function(){var a=this.get("caller"),r=a.get("input"),i={background:r.css("background"),borderLeftColor:r.css("border-left-color"),zIndex:r.css("z-index")};r.css({background:"none #fff",borderLeftColor:"#fdbd78",zIndex:e.UA.ie<8?-1:0});this._flashBackgroundAnim(r,4,function(){t.css(r,i);r._inFlash=false})},_flashBackgroundAnim:function(t,a,r){var i=this;if(a<=0){if(r){r.call()}return}new e.Anim(t,{backgroundColor:a%2==0?"#fdbd78":"#fff"},.3,"easeNone",function(){i._flashBackgroundAnim(t,--a,r)}).run()},renderPlugin:function(e){},update:function(e){if(!e||typeof e!=="object")return;if(!this.get("caller")){this._tasks.push(["update",arguments]);return}e.text&&this.set("text",e.text);e.query&&this.set("query",e.query);e.redirectUrl&&this.set("redirectUrl",e.redirectUrl);e.xiaoer&&this.set("xiaoer",e.xiaoer);this._customizeText();this._customizeSearch()}},{ATTRS:{pluginId:{value:"placeholder"},colors:{value:["#ccc","#666"]},text:{value:"\u641c\u7d22 \u5929\u732b \u5546\u54c1/\u54c1\u724c/\u5e97\u94fa",setter:function(e){return typeof e==="string"?e:"\u641c\u7d22 \u5929\u732b \u5546\u54c1/\u54c1\u724c/\u5e97\u94fa"}},query:{value:"",setter:function(e){return typeof e==="string"?e:""}},redirectUrl:{value:"",setter:function(e){return typeof e==="string"&&e!=="notRedirect"?e:""}},xiaoer:{value:0,setter:function(e){return e?1:0}},caller:{value:undefined,setter:function(e){if(e){var t=this;setTimeout(function(){var e=t._tasks;for(var a=0,r=e.length,i;a<r;a++){i=e.shift();t[i[0]].apply(t,i[1])}},10);return e}}}}});return i},{requires:["dom","base"]});KISSY.add("mui/searchbar/plugin/inShop",function(e,a,t,r){function i(e){i.superclass.constructor.call(this,e||{})}e.extend(i,t,{pluginInitializer:function(e){this.set("caller",e);this.init()},init:function(){var a=this.get("caller");if(!a)return;var t=a.get("input"),r=a.get("form"),i=a.get("dim"),n=a.get("log"),o=this.get("action"),s=this.get("button"),u=a.get("sugConfig").extraParams;if(s&&o){s.on("click",function(){var s=e.trim(t.val());r.attr("data-action",r.attr("action"));r.attr("action",o);var c={q:s,type:"p",search:"y",newHeader_b:"s_from",searcy_type:"item",from:i+"_2_searchbutton"};if(u["spm"]){c["spm"]=u["spm"].substr(0,u["spm"].lastIndexOf(".")+1)+"d101"}a.filterFormParams(c);a.clicklog(","+t.val()+","+t.val()+","+i+"-,"+n.clickId+",inshopsrchbtn,2,"+n.isMobile);r.fire("submit",{ignoreClicklog:1});setTimeout(function(){r.attr("action",r.attr("data-action"));r.removeAttr("data-action")},0)})}}},{ATTRS:{pluginId:{value:"inShop"},action:{value:"",setter:function(e){return e}},button:{value:"",setter:function(e){return r.one(e)}}}});return i},{requires:["event","base","node"]});KISSY.add("mui/searchbar/template/act",function(e,t){var a={name:"act",text:"",promo:"49218",tpl:'<div class="{$prefixCls}mi-act" data-tpl="act" data-params="q={$query}&promo={promo}&type=p&xl={$wq}_1&from={$dim}_1_suggest">'+'<span class="{$prefixCls}mi-cont-key">{$query}</span>'+'<span class="{$prefixCls}mi-cont-text">\u5728<b>{text}</b>\u4e0b\u641c\u7d22</span>'+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugAct,option,suggest,{$pageType},{$isMobile}",parse:function(t,a,r){var i=r["$query"]||"";if(i==="undefined"||e.trim(i)===""||!this.text)return;r["text"]=this.text;r["promo"]=this.promo;var n=e.substitute(this.tpl,r);t.push({textContent:i,content:n})}};return a},{requires:["ajax"]});KISSY.add("mui/searchbar/template/shipShop",function(e){var t={name:"shipShop",tpl:'<div class="{$prefixCls}mi-ship" data-tpl="shipShop" data-index="0" data-params="q={$query}&type=2&style=w&xl={$wq}_2&from={$dim}_2_suggest">'+'<span class="{$prefixCls}mi-ship-wrap" data-url="{$shopUrl}"><img class="{$prefixCls}mi-ship-img" src="{$logo}"><span class="{$prefixCls}mi-ship-key">{$shopName}</span><i class="{$prefixCls}mi-ship-icon"></i></span>'+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugShop,{$userId},suggest,{$pageType},{$isMobile},2",parse:function(t,a,r){var i=r["$query"],n=this;if(i&&a["shop_info"]&&a["shop_info"].length){for(var s=0;s<a["shop_info"].length;s++){e.each(a["shop_info"][s],function(e,t){switch(t){case"shop_name":r["$shopName"]=e;break;case"logo":r["$logo"]="//img.alicdn.com/tfscom/"+e;break;case"shop_url":r["$shopUrl"]=e;break;default:}});r["$query"]=e.urlEncode(i);var o=e.substitute(n.tpl,r);t.push({textContent:i,content:o})}}}};return t});KISSY.add("mui/searchbar/template/cat",function(e,t){var a={name:"cat",tpl:'<div class="{$prefixCls}mi-cat" data-tpl="cat" data-index="{$index}" data-params="q={$2}&cat={$1}&type=p&xl={$wq}_{$index}&from={$dim}_1_suggest">'+'<span class="{$prefixCls}mi-cont-text">\u5728<b>{$0}</b>\u5206\u7c7b\u4e0b\u641c\u7d22</span>'+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugCat,{cat},suggest,{$pageType},{$isMobile}",parse:function(t,a,r){var i=a["cat"];if(a["tmall_noresult"]||!i||!e.isArray(i)||a.result.length<1)return;var n={textContent:"",content:'<div class="{$prefixCls}mi-cat" data-tpl="cat" data-index="0" data-params="q={$2}&type=p&xl={$wq}_{$index}&from={$dim}_1_suggest"><span class="{$prefixCls}mi-cont-key">{$2}</span></div>'};t.push(n);for(var o=0,s=Math.min(i.length,2),u="";o<s;o++){r["$index"]=1+o;var c=i[o];if(e.isArray(c)){for(var l=0;l<3;l++){r["$"+l]=c[l]||r["$query"]}}u=e.substitute(this.tpl,r);n.textContent=r["$2"];n.content=e.substitute(n.content,r);t.push({textContent:r["$2"],content:u})}t.push({content:'<div class="hr"/>',disabled:true})}};return a},{requires:["dom"]});KISSY.add("mui/searchbar/template/list",function(e){var t={name:"list",tpl:'<div class="{$prefixCls}mi-list" data-tpl="list" data-index="{$index}" data-params="q={$query}&type=p&xl={$wq}_{$index}&from={$dim}_1_suggest">'+'<span class="{$prefixCls}mi-cont-key">{text}</span>'+'<span class="{$prefixCls}mi-cont-count">\u7ea6{count}\u4e2a\u7ed3\u679c</span>'+'<a class="{$prefixCls}mi-btn-backfill" href="javascript:;">\u56de\u586b</a>'+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugQuery,query,suggest,{$pageType},{$isMobile}",parse:function(t,a,r){var i=this,n=r["$query"];a["tmall_noresult"]&&t.push({content:'<div class="'+r["$prefixCls"]+'mi-noresult-tip">\u56e7\uff0c\u60a8\u8f93\u5165\u7684\u5173\u952e\u8bcd\u4e0b\u6ca1\u6709\u7ed3\u679c\uff0c\u8bd5\u8bd5\u8fd9\u4e9b\u5427\uff1a</div>',disabled:true});e.each(a.result,function(o,s){if(!o||!o[0]){a.result.splice(s,1);return}for(var u in t){if(t[u].textContent===o[0])return}var c=o[0],l=n;if(!c.match(/\<(\/)?\w\>/gi)){while(c.indexOf(l)<0){l=l.substr(0,l.length-1)}var p=c.indexOf(l),m=p+l.length,d=c.substr(0,p),h=c.substr(m);d=d?"<b>"+d+"</b>":"";h=h?"<b>"+h+"</b>":"";c=d+l+h}r["$query"]=e.urlEncode(o[0].replace(/\<(\/)?\w\>/gi,""));r["$index"]=s+1;r["text"]=c;r["count"]=o[1];var f=e.substitute(i.tpl,r);t.push({textContent:e.urlDecode(r["$query"]),content:f})})}};return t});KISSY.add("mui/searchbar/template/shop",function(e){var t={name:"shop",tpl:'<div class="{$prefixCls}mi-tip" data-tpl="shop" data-params="q={$query}&type=p&style=w&xl={$wq}_2&from={$dim}_2_suggest">'+"<i></i>\u627e\u201c<b>{$text}</b>\u201d\u76f8\u5173<em>\u5e97\u94fa</em>"+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugShop,option,suggest,{$pageType}",parse:function(t,a,r){var i=r["$query"];if(e.trim(i)===""||i=="undefined")return;r["$query"]=e.urlEncode(i);r["$text"]=i;var n=e.substitute(this.tpl,r);t.push({textContent:i,content:n})}};return t});KISSY.add("mui/searchbar/template/quickSearch",function(e){var t={name:"quickSearch",tpl:'<p class="{$prefixCls}mi-qs"><i></i>\u6309\u5feb\u6377\u952e <em>shift</em> + <em>?</em> \u53ef\u4ee5\u968f\u65f6\u6253\u5f00\u5feb\u6377\u641c\u7d22\u6846\uff0c\u8d76\u7d27\u8bd5\u8bd5\u5427~</p>',parse:function(t,a,r){var i=r["$query"];if(e.trim(i)==="")return;var n=e.substitute(this.tpl,r);t.push({content:n,disabled:true})}};return t});KISSY.add("mui/searchbar/plugin/hq4Pc",function(e,a,t,r,i){function n(e){n.superclass.constructor.call(this,e||{})}e.extend(n,r,{pluginInitializer:function(e){this.set("caller",e);this.init()},init:function(){var e=this,a=this.get("url");if(e.get("data")&&e.get("data").length){this.fire("dataReady",{data:e.get("data")})}else{this._render()}},_render:function(){var r=this;this.on("dataReady",function(i){var n=r.get("caller");if(!n){return}var o=i.data,s=n.get("dim"),u='<li class="{highlight}"><a href="javascript:;" data-params="q={query}&type=p&cat={cat}&click_id={query}'+'&from={dim}_{xiaoer}.{index}_hq">{query}</a></li>',c={},l=[];l.push('<ul class="s-hot-query">');c["dim"]=s;e.each(o,function(a,t){c["xiaoer"]=a.xiaoer?"1":"0";c["index"]=t+1;c["query"]=a.query;c["highlight"]=a.highlight?"hot-query-highlight":"";c["cat"]=a.cat;var r=e.substitute(u,c);l.push(r)});l.push("</ul>");var m=a.create(l.join("")),h=r.get("container");a.append(m,h);e.log("searchbar::show hot queries successfully!");var p=n.get("form"),d=n.get("sugConfig").extraParams,g=n.get("log");t.delegate(m,"click","a",function(t){var r=e.unparam(a.attr(t.currentTarget,"data-params"));if(d["spm"]){r["spm"]=d["spm"].substr(0,d["spm"].lastIndexOf(".")+1)+"d102"}n.filterFormParams(r);n.clicklog(","+r["q"]+","+r["q"]+","+s+"-,"+g.clickId+",hq,1,"+g.isMobile);p.attr("target","_blank");p.fire("submit",{ignoreClicklog:1});p.attr("target","_self")})})},update:function(e){if(!e||typeof e!=="object")return;e.url&&this.set("url",e.url);e.data&&this.set("data",e.data);e.container&&this.set("container",e.container)}},{ATTRS:{pluginId:{value:"hq4Pc"},url:{value:""},container:{value:document.body},data:{value:[],setter:function(a){if(e.isArray(a)){this.fire("dataReady",{data:a});return a}return[]}}}});return n},{requires:["dom","event","base","ajax"]});KISSY.add("mui/searchbar/template/meetingPlace",function(e,t,a){function r(){var e=t.query("meta")||[];var a,r="0.0";for(a=0;a<e.length;a++){if(t.attr(e[a],"name")==="spm-id"){r=t.attr(e[a],"content");break}}return r}var i={name:"meetingPlace",tpl:'<div class="{$prefixCls}mi-meetingPC" data-tpl="meetingPlace" data-index="0" data-params="q={$query}&type=2&style=w&xl={$wq}_2&from={$dim}_2_suggest">'+'<a class="{$prefixCls}mi-meetingPC-wrap" target="_blank" href="{$actionUrl}"><img class="{$prefixCls}mi-meetingPC-img" src="{$imgUrl}"></a>'+"</div>",atpanel:"{$index},{q},{$wq},{$dim}-sugShop,{$userId},suggest,{$pageType},{$isMobile},2",parse:function(t,i,n){var o=n["$query"],s=this;if(o&&i["banner"]&&i["banner"].length){for(var u=0;u<i["banner"].length;u++){e.each(i["banner"][u],function(e,t){switch(t){case"bannerText":n["$bannerText"]=e;break;case"imgUrl":n["$imgUrl"]=e;break;case"actionUrl":n["$actionUrl"]=e;break;default:}});n["$query"]=e.urlEncode(o);var l=n["$actionUrl"];try{var c=new a(n["$actionUrl"]);var p=r()+".banner.1";c.query&&c.query.add("spm",p);n["$actionUrl"]=c.toString(false)}catch(m){n["$actionUrl"]=l}var d=e.substitute(s.tpl,n);t.push({textContent:o,content:d})}}}};return i},{requires:["dom","uri"]});!function(){function n(n,t,e){var r,i,a,o,f;r=function(n){function t(){var n="";for(var t in r)n+=t+"|";return n=n.slice(0,-1),a=new RegExp(n,"g")}var e,r={"&":"&amp;",">":"&gt;","<":"&lt;","`":"&#x60;","/":"&#x2F;",'"':"&quot;","'":"&#x27;"},i=/[&<>"'`]/,a=t(),o=/\\?\{([^{}]+)\}/g,f="undefined"!=typeof global?global:window,u=Object.prototype.toString;return n=e={isArray:Array.isArray||function(n){return"[object Array]"===u.call(n)},keys:Object.keys||function(n){var t,e=[];for(t in n)n.hasOwnProperty(t)&&e.push(t);return e},each:function(n,t,r){if(n){var i,a,o,f=0,u=n&&n.length,s=void 0===u||"[object Function]"===Object.prototype.toString.call(n);if(r=r||null,s)for(o=e.keys(n);f<o.length&&(i=o[f],t.call(r,n[i],i,n)!==!1);f++);else for(a=n[0];u>f&&t.call(r,a,f,n)!==!1;a=n[++f]);}return n},mix:function(n,t){for(var e in t)n[e]=t[e];return n},globalEval:function(n){f.execScript?f.execScript(n):!function(n){f.eval.call(f,n)}(n)},substitute:function(n,t,e){return"string"==typeof n&&t?n.replace(e||o,function(n,e){return"\\"===n.charAt(0)?n.slice(1):void 0===t[e]?"":t[e]}):n},escapeHtml:function(n){return n=""+n,i.test(n)?(n+"").replace(a,function(n){return r[n]}):n},merge:function(){for(var n=0,t=arguments.length,r={};t>n;n++){var i=arguments[n];i&&e.mix(r,i)}return r}}}(),i=function(n){function t(n,t,e){this.data=void 0!==n?n:{},e?(this.parent=e,this.root=e.root):(this.parent=void 0,this.root=this),this.affix=t||{},this.ready=!1}return t.prototype={isScope:1,constructor:t,setParent:function(n){this.parent=n,this.root=n.root},set:function(n,t){this.affix[n]=t},setData:function(n){this.data=n},getData:function(){return this.data},mix:function(n){var t=this.affix;for(var e in n)t[e]=n[e]},get:function(n){var t,e=this.data,r=this.affix;return null!=e&&(t=e[n]),void 0!==t?t:r[n]},resolveInternalOuter:function(n){var t,e=n[0],r=this,i=r;if("this"===e)t=r.data;else if("root"===e)i=i.root,t=i.data;else{if(!e)return[i.data];do t=i.get(e);while(void 0===t&&(i=i.parent))}return[void 0,t]},resolveInternal:function(n){var t=this.resolveInternalOuter(n);if(1===t.length)return t[0];var e,r=n.length,i=t[1];if(void 0===i)return void 0;for(e=1;r>e;e++)i=i[n[e]];return i},resolveLooseInternal:function(n){var t=this.resolveInternalOuter(n);if(1===t.length)return t[0];var e,r=n.length,i=t[1];for(e=1;null!=i&&r>e;e++)i=i[n[e]];return i},resolveUp:function(n){return this.parent&&this.parent.resolveInternal(n)},resolveLooseUp:function(n){return this.parent&&this.parent.resolveLooseInternal(n)},resolveOuter:function(n,t){var e,r=this,i=r;if(!t&&1===n.length){if(e=r.get(n[0]),void 0!==e)return[e];t=1}if(t)for(;i&&t--;)i=i.parent;return i?[void 0,i]:[void 0]},resolveLoose:function(n,t){var e=this.resolveOuter(n,t);return 1===e.length?e[0]:e[1].resolveLooseInternal(n)},resolve:function(n,t){var e=this.resolveOuter(n,t);return 1===e.length?e[0]:e[1].resolveInternal(n)}},n=t}(),a=function(n){function t(n,t,e){this.list=n,this.init(),this.next=t,this.ready=!1,this.tpl=e}function e(n,e){var r=this;r.config=e,r.head=new t(r,void 0),r.callback=n,this.init()}var i=r;return t.prototype={constructor:t,isBuffer:1,init:function(){this.data=""},append:function(n){return this.data+=n,this},write:function(n){if(null!=n){if(n.isBuffer)return n;this.data+=n}return this},writeEscaped:function(n){if(null!=n){if(n.isBuffer)return n;this.data+=i.escapeHtml(n)}return this},insert:function(){var n=this,e=n.list,r=n.tpl,i=new t(e,n.next,r),a=new t(e,i,r);return n.next=a,n.ready=!0,a},async:function(n){var t=this.insert(),e=t.next;return n(t),e},error:function(n){var t=this.list.callback;if(t){var e=this.tpl;if(e){n instanceof Error||(n=new Error(n));var r=e.name,i=e.pos.line,a="XTemplate error in file: "+r+" at line "+i+": ";n.stack=a+n.stack,n.message=a+n.message,n.xtpl={pos:{line:i},name:r}}this.list.callback=null,t(n,void 0)}},end:function(){var n=this;return n.list.callback&&(n.ready=!0,n.list.flush()),n}},e.prototype={constructor:e,init:function(){this.data=""},append:function(n){this.data+=n},end:function(){this.callback(null,this.data),this.callback=null},flush:function(){for(var n=this,t=n.head;t;){if(!t.ready)return n.head=t,void 0;this.data+=t.data,t=t.next}n.end()}},e.Buffer=t,n=e}(),o=function(n){var t=i,e=r,a={range:function(n,t){var e=t.params,r=e[0],i=e[1],a=e[2];a?(r>i&&a>0||i>r&&0>a)&&(a=-a):a=r>i?-1:1;for(var o=[],f=r;i>r?i>f:f>i;f+=a)o.push(f);return o},foreach:function(n,e,r){var i,a,o,f,u=e.params,s=u[0],l=u[2]||"xindex",c=u[1];if(s)for(i=s.length,f=0;i>f;f++)a=new t(s[f],{xcount:i,xindex:f},n),o=a.affix,"xindex"!==l&&(o[l]=f,o.xindex=void 0),c&&(o[c]=s[f]),r=e.fn(a,r);return r},forin:function(n,e,r){var i,a,o,f=e.params,u=f[0],s=f[2]||"xindex",l=f[1];if(u)for(o in u)i=new t(u[o],{xindex:o},n),a=i.affix,"xindex"!==s&&(a[s]=o,a.xindex=void 0),l&&(a[l]=u[o]),r=e.fn(i,r);return r},each:function(n,t,r){var i=t.params,o=i[0];return o?e.isArray(o)?a.foreach(n,t,r):a.forin(n,t,r):r},"with":function(n,e,r){var i=e.params,a=i[0];if(a){var o=new t(a,void 0,n);r=e.fn(o,r)}return r},"if":function(n,t,e){var r=t.params,i=r[0];if(i){var a=t.fn;a&&(e=a(n,e))}else{var o=!1,f=t.elseIfs,u=t.inverse;if(f)for(var s=0,l=f.length;l>s;s++){var c=f[s];if(o=c.test(n)){e=c.fn(n,e);break}}!o&&u&&(e=u(n,e))}return e},set:function(n,t,e){for(var r=t.hash,i=r.length,a=0;i>a;a++){var o=r[a],f=o.key,u=o.depth,s=o.value;if(1===f.length){for(var l=n.root;u&&l!==n;)n=n.parent,--u;n.set(f[0],s)}else{var c=n.resolve(f.slice(0,-1),u);c&&(c[f[f.length-1]]=s)}}return e},include:1,parse:1,extend:1,block:function(n,t,e){var r,i=this,a=i.runtime,o=t.params,f=o[0];2===o.length&&(r=o[0],f=o[1]);var u,s=a.blocks=a.blocks||{},l=s[f],c={fn:t.fn,type:r};if(l){if(l.type)if("append"===l.type)c.next=l,s[f]=c;else if("prepend"===l.type){var d;for(u=l;u&&"prepend"===u.type;)d=u,u=u.next;c.next=u,d.next=c}}else s[f]=c;if(!a.extendTpl)for(u=s[f];u;)u.fn&&(e=u.fn.call(i,n,e)),u=u.next;return e},macro:function(n,e,r){var i=e.hash,a=e.params,o=a[0],f=a.slice(1),u=this,s=u.runtime,l=s.macros=s.macros||{},c=l[o];if(e.fn)l[o]={paramNames:f,hash:i,fn:e.fn};else if(c){var d,v=c.hash||{};if(d=c.paramNames)for(var h=0,p=d.length;p>h;h++){var m=d[h];v[m]=f[h]}if(i)for(var g in i)v[g]=i[g];var x=new t(v);x.root=n.root,r=c.fn.call(u,x,r)}else{var y="can not find macro: "+o;r.error(y)}return r}};return a["debugger"]=function(){},n=a}(),f=function(n){function t(n,t,e,r,i,a,o,f){this.name=n,this.originalName=a||n,this.runtime=t,this.root=e,this.pos={line:1},this.scope=r,this.buffer=i,this.fn=o,this.parent=f}function e(n,t,e){var r=e[0],i=n&&n[r]||t&&t[r]||g[r];if(1===e.length)return i;if(i)for(var a=e.length,o=1;a>o;o++)if(i=i[e[o]],!i)return!1;return i}function f(n,t){var e=n.split("/"),r=t.split("/");e.pop();for(var i=0,a=r.length;a>i;i++){var o=r[i];"."===o||(".."===o?e.pop():e.push(o))}return e.join("/")}function u(n,t,r,i,a,o){var f,u,s;if(o||(s=e(n.runtime.commands,n.root.config.commands,a)),s)return s.call(n,t,r,i);if(s!==!1&&(f=t.resolve(a.slice(0,-1),o),u=f[a[a.length-1]]))try{return u.apply(f,r.params||[])}catch(l){return i.error("Execute function `"+a.join(".")+"` Error: "+l.message),i}return i.error("Command Not Found: "+a.join(".")),i}function s(n,t){var e=this;e.fn=n,e.config=p.merge(s.globalConfig,t),this.subNameResolveCache={}}function l(n,t,e){if("."!==t.charAt(0))return t;var r=e+"_ks_"+t,i=n.subNameResolveCache,a=i[r];return a?a:t=i[r]=f(e,t)}function c(n,t,e,r,i,a){var o=l(n,a,i.name),f=r.insert(),u=f.next;return v(n,o,i.runtime,t,f,a,e,r.tpl),u}function d(n,e,r,i,a){var o=r.insert(),f=o.next,u=new t(a.TPL_NAME,i.runtime,n,e,o,void 0,a,r.tpl);return o.tpl=u,h(u),f}function v(n,e,r,i,a,o,f,u){var s=new t(e,r,n,i,a,o,void 0,u);a.tpl=s,n.config.loader.load(s,function(n,t){"function"==typeof t?(s.fn=t,h(s)):n?a.error(n):(t=t||"",f?a.writeEscaped(t):a.data+=t,a.end())})}function h(n){var t=n.fn();if(t){var e,r=n.runtime,i=r.extendTpl;if(i&&(e=i.params[0],!e))return t.error("extend command required a non-empty parameter");var a=r.extendTplFn,o=r.extendTplBuffer;return a?(r.extendTpl=null,r.extendTplBuffer=null,r.extendTplFn=null,d(n.root,n.scope,o,n,a).end()):e&&(r.extendTpl=null,r.extendTplBuffer=null,c(n.root,n.scope,0,o,n,e).end()),t.end()}}var p=r,m=o,g={},x=i,y=a,w={callFn:u,callDataFn:function(n,t){for(var e=t[0],r=e,i=1;i<t.length;i++){var a=t[i];if(!r||null==r[a])return"";e=r,r=r[a]}return r.apply(e,n||[])},callCommand:function(n,t,e,r,i){return u(n,t,e,r,i)}};return p.mix(s,{config:function(n,t){var e=this.globalConfig=this.globalConfig||{};return arguments.length?(void 0!==t?e[n]=t:p.mix(e,n),void 0):e},nativeCommands:m,utils:w,util:p,addCommand:function(n,t){g[n]=t},removeCommand:function(n){delete g[n]}}),s.prototype={constructor:s,Scope:x,nativeCommands:m,utils:w,removeCommand:function(n){var t=this.config;t.commands&&delete t.commands[n]},addCommand:function(n,t){var e=this.config;e.commands=e.commands||{},e.commands[n]=t},include:function(n,t,e,r){var i,a=t.params;i=n;var o=t.hash,f=t&&t.escape;return o&&(i=new x(o,void 0,n)),a[0]?e=c(this,i,f,e,r,a[0]):e.error("include command required a non-empty parameter")},includeModule:function(n,t,e,r){var i=t.params,a=n,o=t.hash;return o&&(a=new x(o,void 0,n)),i[0]?e=d(this,a,e,r,i[0]):e.error("include command required a non-empty parameter")},render:function(n,e,r){var i="",a=this,o=a.fn,f=a.config;"function"==typeof e&&(r=e,e=null),e=e||{},r=r||function(n,t){if(n)throw n instanceof Error||(n=new Error(n)),n;i=t};var u=a.config.name;!u&&o&&o.TPL_NAME&&(u=o.TPL_NAME);var l;l=n instanceof x?n:new x(n);var c=new s.LinkedBuffer(r,f).head,d=new t(u,{commands:e.commands},a,l,c,u,o);return c.tpl=d,o?(h(d),i):(f.loader.load(d,function(n,t){t?(d.fn=a.fn=t,h(d)):n&&c.error(n)}),i)}},s.Scope=x,s.LinkedBuffer=y,n=s}(),e.exports=f}if(window.KISSY)KISSY.add("kg/xtemplate/4.1.4/runtime",[],function(t,e,r,i){n(e,r,i)});else{if(!window.define)throw new Error("Can't found any module manager, such like Kissy CMD AMD SeaJS and etc.");define("kg/xtemplate/4.1.4/runtime",[],n)}}();