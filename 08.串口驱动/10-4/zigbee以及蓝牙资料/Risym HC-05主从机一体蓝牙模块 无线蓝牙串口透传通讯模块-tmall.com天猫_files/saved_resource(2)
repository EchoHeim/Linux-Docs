KISSY.add("detail-model/productCombo",function(e,t){function n(){var n=new t;_CTK6da3(7,"model.productCombo.init","app.init");n.addAttr("config",{load:function(e){e(null)}});n.addAttr("mdskip",{load:function(e){e(null)}});n.addAttr("model",{load:function(e){e(null)}});n.addAttr("locModel",{load:function(e){e(null)}});n.addAttr("itemData",{});n.addAttr("amount",{validator:function(e){return!isNaN(e=parseInt(e,10))&&e>0},setter:function(e){return parseInt(e,10)},load:function(e){n.onLoad("itemData",function(t){e(t.fixedQuantity||1)})}});n.addAttr("selectedSkuProp",{load:function(e){e({})}});n.addAttr("currentInventory",{load:function(t){n.onChange(["itemData","skuMap","selectedSkuList"],function(n,i,a){var r=0;if(a){e.each(a,function(t){e.each(i,function(e){if(t.skuId==e.skuId){r+=e.stock}})})}else{r+=n.stock||n.showQuantity}t({type:1,quantity:r})})}});n.addAttr("skuMap",{load:function(e){n.onChange("itemData",function(t){var n=t.skuMap||t.skuInfoMap;e(n&&!n.def?n:null)})}});n.addAttr("skuProp",{load:function(t){n.onChange(["skuMap","itemData"],function(n,i){var a={};if(!n){t(a);return}for(var r in n){if(!n.hasOwnProperty(r)){continue}var o=r.split(";");for(var u=0;u<o.length;u++){if(!o[u]){continue}var c=o[u].split(":");if(!c[0]||!c[1]){continue}if(!a[c[0]]){a[c[0]]={}}a[c[0]][c[1]]={label:"",text:"",info:""}}}e.each(i.prop,function(t,n){e.each(t,function(e,t){var i=t.split(":");var r=a[i[0]]&&a[i[0]][i[1]];if(!r){return}r.label=n;r.text=e[0];r.pic=e[1]})});t&&t(a)})}});n.addAttr("currentPriceInfoList",{load:function(t){n.onChange(["selectedSkuList"],function(n){var i=[];if(n){e.each(n,function(e){i.push(e)})}t(i)})}});n.addAttr("originalPrice",{load:function(e){n.onChange(["currentPriceInfoList","selectedSku","itemData"],function(t,n,i){var a={},r=true,o;if(t){for(var u in t){if((o=t[u]&&t[u].price)!==undefined){a.min=Number(o)>Number(a.min)?a.min:o;a.max=Number(o)<Number(a.max)?a.max:o;r=false}}}if(r&&n){for(var u in n){if(o=n[u]&&n[u].price){a.min=Number(o)>Number(a.min)?a.min:o;a.max=Number(o)<Number(a.max)?a.max:o;r=false}}}if(r&&i){if(o=i&&i.price){a.min=a.max=o;r=false}}if(r&&i){if((o=i&&i.showPrice)!==undefined){a.min=a.max=i.showPrice/100;r=false}}if(r){a=null}else{a.str=a.min;if(a.min!=a.max){a.str+="-"+a.max}}e(a)})}});n.addAttr("comboPrice",{load:function(e){n.onChange(["currentPriceInfoList","selectedSku","itemData"],function(t,n,i){var a={},r=true,o;if(t){for(var u in t){if(t[u]&&t[u].price!=null){o=t[u].comboPrice!=null?t[u].comboPrice:t[u].price;a.min=Number(o)>Number(a.min)?a.min:o;a.max=Number(o)<Number(a.max)?a.max:o;r=false}}}if(r&&n){for(var u in n){if(o=n[u]&&n[u].price!=null){o=n[u].comboPrice!=null?n[u].comboPrice:n[u].price;a.min=Number(o)>Number(a.min)?a.min:o;a.max=Number(o)<Number(a.max)?a.max:o;r=false}}}if(r&&i){if(i&&i.price!=null){o=i.comboPrice!=null?i.comboPrice:i.price;a.min=a.max=o;r=false}}if(r&&i){if((o=i&&i.discountPrice)!==undefined){a.min=a.max=(i.showPrice-i.discountPrice)/100;r=false}}if(r){a=null}else{a.str=a.min;if(a.min!=a.max){a.str+="-"+a.max}}e(a)})}});n.addAttr("saveMoney",{load:function(e){n.onChange(["currentPriceInfoList","itemData"],function(t,n){var i={},a=true,r;if(t){for(var o in t){if(t[o]&&t[o].price!=null){r=t[o].price-(t[o].comboPrice!=null?t[o].comboPrice:t[o].price);i.min=Number(r)>Number(i.min)?i.min:r;i.max=Number(r)<Number(i.max)?i.max:r;a=false}}}if(a&&n){if(n&&n.price!=null){r=n.price-(n.comboPrice!=null?n.comboPrice:n.price);i.min=i.max=r;a=false}}if(a){i=null}else{i.str=i.min;if(i.min!=i.max){i.str+="-"+i.max}}e(i)})}});n.addAttr("itemEnable",{load:function(e){e(true);n.onLoad("itemData",function(t){if(!t.master&&!(t.isSelected||t.selected)){e(false)}})}});n.addBuyValidator(function(e,t){n.onLoad(["itemData"],function(e){t(e.disabled?{level:8,name:"notCanBuy",message:e.disabledMessage}:null)})},8);n.onChange("itemData",function(e){e.pictUrl=e.pictUrl.replace(/_\d+x\d+\.jpg/,"")},0);e.mix(n,{canSelectSkuProp:function(t,n,i,a){a=a||{};if(t.indexOf(":")>=0){var r=t.split(":",2);t=r[0];n=r[1]}if(!n){i(0);return}var o=this;function u(e){if(a.ignoreSelection){e({});return}o.onLoad("selectedSkuProp",e)}u(function(a){if(a[t]==n){i(1);return}var r=e.mix({},a);r[t]=n;o.onSkuList(r,function(t){var n=false;e.each(t,function(e){if(n){return}if(e.stock>0||e.stock==-1){n=true}});if(!n){i(0);return}i(1)})})},selectSkuProp:function(t,n,i){if(t.indexOf(":")>=0){var a=t.split(":",2);t=a[0];n=a[1]}var r=this;r.canSelectSkuProp(t,n,function(a){if(a<=0){if(i){r.onLoad("selectedSkuProp",function(a){var o=e.keys(a).sort();if(o[0]){r.deselectSkuProp(o[0],"",function(){r.selectSkuProp(t,n,i)})}})}return}r.onLoad(["selectedSkuProp","selectedSku"],function(i,a){if(i[t]==n){return}var o={};e.mix(o,i);o[t]=n;r.set("selectedSkuProp",o)})})}});n.addAttr("service",{load:function(e){n.onChange(["itemData"],function(t){var n=t.services;if(!n){return e(null)}var i=[];for(var a=0,r=n.length;a<r;a++){var o={};if(n[a]["uniqueServices"]){for(var u=0,c=n[a]["uniqueServices"].length;u<c;u++){var l=n[a]["uniqueServices"][u];o.isFree=l.isFree;o.price=l.price;o.priceStr=l.isFree?"\u5546\u5bb6\u8d60\u9001":l.price;o.selected=l.isFree?true:false;o.name=n[a]["spuName"]+(l["uniqueName"]?l["uniqueName"]:"");o.id=n[a]["serviceId"];o.icon=n[a]["tagImage"];o.uniqueId=l["uniqueId"];o.multiSelect=n[a]["multiSelect"];i.push(o);o={}}}else{o.price=n[a]["price"];o.isFree=n[a]["isFree"];o.priceStr=n[a].isFree?"\u5546\u5bb6\u8d60\u9001":n[a].price;o.selected=n[a]["isFree"]?true:false;o.name=n[a]["spuName"];o.id=n[a]["serviceId"];o.uniqueId=0;o.icon=n[a]["tagImage"];if(t.householdService){o.multiSelect=n[a]["multiSelect"]}i.push(o);o={}}}if(t.householdService&&i.length>0){i[0].selected=true}e({list:i,stype:t.householdService?"house":null})})}});n.addAttr("canBuyStatus",{load:function(e){n.onChange(["itemData","amount"],function(){var e=n.get("canBuyStatus");if(e){n.set("canBuyStatus",++e)}else{n.set("canBuyStatus",1)}})}});n.onChange("buyerLoc",function(){n.set("locModel",null)},0);return n}return n},{requires:["detail-model/product"]});