KISSY.add("tbc/search-suggest/1.4.5/mods/storage",["base","json"],function(e,a,t,r){function s(e){return o||(s.superclass.constructor.call(this,e||{}),o=this,o.initialize()),o}var o,i=a("base"),n=a("json");s.ATTRS={src:{value:location.protocol+"//g.alicdn.com/tbc/search-suggest/1.3.7/storage.swf"},bridge:{value:null},hasInit:{value:!1}},e.extend(s,i,{initialize:function(a){a=a||{};var t=this;try{t._addFlash(a.appendTo),t.hasInit=!0}catch(r){e.log(r.message)}},_saveToArr:function(e,a){var t=this.lazyArr||[];t.push({func:e,args:a}),this.lazyArr=t},_addFlash:function(a){var t,r=this,s=document,o=s.createElement("div"),i=r.get("src"),n="";window.__StorageIsReady=function(a){r.isLoaded=!0;var t=r.lazyArr;e.each(t,function(e){e.func.apply(r,e.args)})},o.id="storagetool",o.style.height=0,o.style.overflow="hidden",n+='<object id="J_StorageObj" name="J_StorageObj" ',n+='classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" ',n+='codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab">',n+='<param name="movie" value="'+i+'" />',n+='<param name="allowScriptAccess" value="always" />',n+='<embed name="J_StorageEmbed" src="'+i+'" width="1" height="1" ',n+='allowScriptAccess="always" type="application/x-shockwave-flash" ',n+='pluginspage="http://www.adobe.com/go/getflashplayer">',n+="</embed></object>",a=a||s.body,a.appendChild(o),o.innerHTML=n,-1!==navigator.appVersion.indexOf("MSIE")?(o.style.zoom=1,o.style.filter="alpha(opacity=10)",t=window.J_StorageObj):(o.style.opacity=.1,t=s.J_StorageEmbed),r.set("bridge",t)},save:function(e,a,t,r){var s=this,o=s.get("bridge");if(!s.isLoaded)return void s._saveToArr(arguments.callee,arguments);try{return o.save(e,a),o.read(e)?n.parse(o.read(e)).length:(t&&t.onSuccess(val),0)}catch(i){t&&t.onFailure&&t.onFailure(i)}},read:function(e,a,t){var r,s=this,o=s.get("bridge");if(t=t||0,!s.isLoaded)return void s._saveToArr(arguments.callee,arguments);try{if(o.read)r=o.read(e),a&&a.onSuccess(r);else{if(200===t)return void(a&&a.onFailure&&a.onFailure(i));setTimeout(function(){s.read(e,a,t+1)},500)}return r}catch(i){a&&a.onFailure&&a.onFailure(i)}}}),r.exports=s});