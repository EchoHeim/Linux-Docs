define("kg/detail-viewed-bought-module/6.0.1/index",["node","dom","io","util","event","kg/slide/6.0.8/index","kg/detail-viewed-bought-module/6.0.1/lib/index.css"],function(e,i,a){var t,s,n=e("node"),c=e("dom"),l=e("io"),o=e("util"),d=e("event"),r=e("kg/slide/6.0.8/index");e("kg/detail-viewed-bought-module/6.0.1/lib/index.css");t=function(e){"use strict";function i(){function e(e){return e>99999999?parseFloat(e/1e8).toFixed(1)+"\u4ebf":e>9999?parseFloat(e/1e4).toFixed(1)+"\u4e07":parseFloat(e).toFixed(2)}function i(e,i){var a,t=!0;for(a=0;a<i.length;a++)e.hasOwnProperty(i[a])||(t=!1);return t}var n,c,l=a,o=function(){this.viewed_appid_daily=19671,this.viewed_appid=9,this.viewed_container=l.one("#detail-recommend-viewed"),this.bought_appid_daily=19673,this.bought_appid=11,this.bought_container=l.one("#detail-recommend-bought"),this.count=12,this.render()};m.augment(o,{render:function(){var a,o,d,r,m,g,u=this,h="https://tui.taobao.com",b=u.viewed_appid,v=u.bought_appid,f=u.viewed_container,x=u.bought_container;location.host.indexOf("daily")>-1&&(h="//tui.daily.taobao.net",b=u.viewed_appid_daily,v=u.bought_appid_daily),f&&x&&(o=f.attr("data-sellerid"),d=f.attr("data-catid"),r=f.attr("data-itemid"),d&&o&&r&&(a=h+"/recommend?appid="+b+"&count="+u.count,a+="&sellerid="+o+"&itemid="+r+"&categoryid="+d,new s({type:"get",dataType:"jsonp",url:a,data:{},success:function(a){var s,c,o,d,g,u,h,b,v,x,y,w="";if(a.result){if(m=a.result,m&&m.length<2)return void l.one("#detail-recommend-viewed").hide();for(t.addStyleSheet("#detail-recommend-viewed .related-items{position:relative}"),d=0;d<m.length;d++)s=m[d],r&&r==s.itemId&&m.splice(d,1);for(c=m.length,o=Math.floor(c/4),c%4!=0&&o++,d=0;d<m.length;d++){if(!i(m[d],["price","promotionPrice","pic","itemName"]))return void l.one("#detail-recommend-viewed").hide();m[d].price=e(m[d].price),m[d].promotionPrice=e(m[d].promotionPrice),m[d].extMap&&m[d].extMap.price20141212&&(m[d].promotionPrice=e(m[d].extMap.price20141212)),""==m[d].pic?m[d].pic="//img.alicdn.com/newshop/nopicture.gif":m[d].pic+="_145x145xz.jpg"}w="<div class='related-items' class='grid'><h5>\u770b\u4e86\u8be5\u5b9d\u8d1d\u7684\u4eba\u8fd8\u770b\u4e86</h5>",w+="<div class='small-rect'></div>",w+="<div class='page_num'>1/"+o+"</div>",w+="<div class='prev'></div>",w+="<div class='next'></div>",w+="<div id='viewed-items-slide'><ul class='tab-nav'></ul><div class='scrollable-panel'>";var _=0;for(g=0;o>g&&3>g;g++){for(w+="<div class='item-list'><ul>",u=4*g,_=0;u<m.length&&4>_;u++,_++){h=m[u];var k="",T="";if(h.extMap&&h.extMap.dacuIcon)switch(h.extMap.dacuIcon){case"tb":k='<img class="icon-1212" src="//img.alicdn.com/tps/TB1m05VLXXXXXXGXFXXXXXXXXXX-84-32.png" alt="">';break;case"jingxuan":k='<img class="icon-1212" src="//img.alicdn.com/tps/TB1gYRtLpXXXXb5XXXXXXXXXXXX-72-16.png" alt="">';break;case"tmall":k='<img class="icon-1212" src="//img.alicdn.com/tps/TB1m05VLXXXXXXGXFXXXXXXXXXX-84-32.png" alt="">';break;case"yushou":k='<img class="icon-1212" src="//img.alicdn.com/tps/TB1syPJKpXXXXXHapXXXXXXXXXX-118-32.png" alt="">';break;case"alitrip":k='<img class="icon-1212" src="//img.alicdn.com/tps/TB13TV3KXXXXXcTXXXXXXXXXXXX-160-32.png" alt="">';break;case"xinshili":k='<img class="icon-1212" src="//img.alicdn.com/tps/TB1lwJ5MFXXXXb8XXXXXXXXXXXX-46-16.png" alt="">';break;default:k=""}h.extMap&&h.extMap.hongbao2015&&(T='<span class="hongbao2015"></span>'),h.extMap&&h.extMap.manfan2015&&(T='<span class="manfan2015"></span>'),k?h.itemName.length>23&&(h.itemName=h.itemName.replace(/^(.{23}).*$/,"$1")):h.itemName.length>26&&(h.itemName=h.itemName.replace(/^(.{26}).*$/,"$1"));var M="",j="",N="";j="",N="<div class='desc'><a class='side-item' target='_blank' href='"+h.url+"' >"+k+h.itemName+"</a></div>",M=0!=h.promotionPrice?'<p class="tuijian-price"><span class="tuijian-light"><b class="yen">&yen;</b><b class="price">'+h.promotionPrice+'</b></span><span class="old-price"><b class="yen">&nbsp;&yen;</b><b class="price">'+h.price+"</b></span>"+T+"</p>":"<p class='tuijian-price tuijian-light'><b class='yen'>&yen;</b><b class='price'>"+h.price+"</b></p>",b="<li><div class='item'><div class='pic'><a class='side-item' target='_blank' href='"+h.url+"'><img title='"+h.itemName+"' src='"+h.pic+"'/></a></div>"+N+M+j+"</div></li>",w+=b}w+="</ul></div>"}w+="</div></div></div>",f.html(w),1>=o&&(l.one(".prev","#detail-recommend-viewed").hide(),l.one(".next","#detail-recommend-viewed").hide(),l.one(".page_num","#detail-recommend-viewed").hide()),v=l.all(".item-list",f),x=l.one("#viewed-items-slide",f),y=v.height(),x.height(y),v.height(y),x.css("visibility","visible"),n=new X("#viewed-items-slide",{contentClass:"scrollable-panel",pannelClass:"item-list",effect:"fade"}),p.on(l.one(".prev","#detail-recommend-viewed"),"click",function(){n.currentTab>0?(n.previous(),l.one(".page_num","#detail-recommend-viewed").text(n.currentTab+1+"/"+o)):(n.go(o-1),l.one(".page_num","#detail-recommend-viewed").text(o+"/"+o))}),p.on(l.one(".next","#detail-recommend-viewed"),"click",function(){n.currentTab<o-1?(n.next(),l.one(".page_num","#detail-recommend-viewed").text(n.currentTab+1+"/"+o)):(n.go(0),l.one(".page_num","#detail-recommend-viewed").text("1/"+o))})}},jsonp:"callback",jsonpCallback:"detail_recommend_viewed"}),a=h+"/recommend?appid="+v+"&count="+u.count,a+="&sellerid="+o+"&itemid="+r+"&categoryid="+d,new s({type:"get",dataType:"jsonp",url:a,data:{},success:function(a){var s,n,o,d,m,u,h,b,v,f,y,w="";if(a.result){if(g=a.result,g&&g.length<2)return void l.one("#detail-recommend-bought").hide();for(t.addStyleSheet("#detail-recommend-bought .related-items{position:relative}"),d=0;d<g.length;d++)s=g[d],r&&r==s.itemId&&g.splice(d,1);for(n=g.length,o=Math.floor(n/4),n%4!=0&&o++,d=0;d<g.length;d++){if(!i(g[d],["price","promotionPrice","pic","itemName"]))return void l.one("#detail-recommend-bought").hide();g[d].price=e(g[d].price),g[d].promotionPrice=e(g[d].promotionPrice),g[d].extMap&&g[d].extMap.price20141212&&(g[d].promotionPrice=e(g[d].extMap.price20141212)),""==g[d].pic?g[d].pic="//img.alicdn.com/newshop/nopicture.gif":g[d].pic+="_145x145xz.jpg"}for(w="<div class='related-items' class='grid'><h5>\u4e70\u4e86\u8be5\u5b9d\u8d1d\u7684\u4eba\u8fd8\u4e70\u4e86</h5>",w+="<div class='small-rect'></div>",w+="<div class='page_num'>1/"+o+"</div>",w+="<div class='prev'></div>",w+="<div class='next'></div>",w+="<div id='bought-items-slide'><ul class='tab-nav'></ul><div class='scrollable-panel'>",m=0;o>m&&3>m;m++){w+="<div class='item-list'><ul>";var _=0;for(u=4*m,_=0;u<g.length&&4>_;u++,_++){h=g[u];var k="",T="",M="",j="",N="";if(h.extMap&&h.extMap.dacuIcon)switch(h.extMap.dacuIcon){case"tb":j='<img class="icon-1212" src="//img.alicdn.com/tps/TB1m05VLXXXXXXGXFXXXXXXXXXX-84-32.png" alt="">';break;case"jingxuan":j='<img class="icon-1212" src="//img.alicdn.com/tps/TB1gYRtLpXXXXb5XXXXXXXXXXXX-72-16.png" alt="">';break;case"tmall":j='<img class="icon-1212" src="//img.alicdn.com/tps/TB1m05VLXXXXXXGXFXXXXXXXXXX-84-32.png" alt="">';break;case"yushou":j='<img class="icon-1212" src="//img.alicdn.com/tps/TB1syPJKpXXXXXHapXXXXXXXXXX-118-32.png" alt="">';break;case"alitrip":j='<img class="icon-1212" src="//img.alicdn.com/tps/TB13TV3KXXXXXcTXXXXXXXXXXXX-160-32.png" alt="">';break;case"xinshili":j='<img class="icon-1212" src="//img.alicdn.com/tps/TB1lwJ5MFXXXXb8XXXXXXXXXXXX-46-16.png" alt="">';break;default:j=""}h.extMap&&h.extMap.hongbao2015&&(N='<span class="hongbao2015"></span>'),h.extMap&&h.extMap.manfan2015&&(N='<span class="manfan2015"></span>'),j?h.itemName.length>23&&(h.itemName=h.itemName.replace(/^(.{23}).*$/,"$1")):h.itemName.length>26&&(h.itemName=h.itemName.replace(/^(.{26}).*$/,"$1")),T="",M="<div class='desc'><a class='side-item' target='_blank' href='"+h.url+"' >"+j+h.itemName+"</a></div>",k=0!=h.promotionPrice?'<p class="tuijian-price"><span class="tuijian-light"><b class="yen">&yen;</b><b class="price">'+h.promotionPrice+'</b></span><span class="old-price"><b class="yen">&nbsp;&yen;</b><b class="price">'+h.price+"</b></span>"+N+"</p>":"<p class='tuijian-price tuijian-light'><b class='yen'>&yen;</b><b class='price'>"+h.price+"</b></p>",b="<li><div class='item'><div class='pic'><a class='side-item' target='_blank' href='"+h.url+"'><img title='"+h.itemName+"' src='"+h.pic+"'/></a></div>"+M+k+T+"</div></li>",w+=b}w+="</ul></div>"}w+="</div></div></div>",x.html(w),1>=o&&(l.one(".prev","#detail-recommend-bought").hide(),l.one(".next","#detail-recommend-bought").hide(),l.one(".page_num","#detail-recommend-bought").hide()),v=l.all(".item-list",x),f=l.one("#bought-items-slide",x),y=v.height(),f.height(y),v.height(y),f.css("visibility","visible"),c=new X("#bought-items-slide",{contentClass:"scrollable-panel",pannelClass:"item-list",effect:"fade"}),p.on(l.one(".prev","#detail-recommend-bought"),"click",function(){c.currentTab>0?(c.previous(),l.one(".page_num","#detail-recommend-bought").text(c.currentTab+1+"/"+o)):(c.go(o-1),l.one(".page_num","#detail-recommend-bought").text(o+"/"+o))}),p.on(l.one(".next","#detail-recommend-bought"),"click",function(){c.currentTab<o-1?(c.next(),l.one(".page_num","#detail-recommend-bought").text(c.currentTab+1+"/"+o)):(c.go(0),l.one(".page_num","#detail-recommend-bought").text("1/"+o))})}},jsonp:"callback",jsonpCallback:"detail_recommend_bought"})))}}),new o}var a=n,t=c,s=l,m=o,p=d,X=r;return e=i}(),s=function(e){return e=t}(),a.exports=s});