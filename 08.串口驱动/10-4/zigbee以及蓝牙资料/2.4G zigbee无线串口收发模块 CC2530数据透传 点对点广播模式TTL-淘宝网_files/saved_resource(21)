KISSY.add("recommend/detail/page_pine_module/page_pine_module",function(a,b,c,d,e,f){function g(b){return this.container=a.one("#J_Pine"),this.container?a.UA.ie&&a.UA.ie<7?void a.log("hide offline module in ie6\uff01"):(this.sellerid=this.container.attr("data-sellerid"),this.categoryid=this.container.attr("data-catid"),this.itemid=this.container.attr("data-itemid"),this.sellerid&&this.categoryid&&this.itemid?b.height?(this.appid=115,this.appid_daily=19670,this.count=j(b.height),this.bindEvent(),void this.request(!0)):void a.log("\u8bf7\u4f20\u5165\u9875\u9762\u9ad8\u5ea6\u914d\u7f6e\u9879\uff01"):void a.log("\u672a\u83b7\u53d6\u5230sellerid\u6216categoryid\u6216itemid!")):void a.log("\u672a\u627e\u5230J_Pine\u6a21\u5757\uff01")}function h(a,b){var c,d={list:[]};if(!a.result)return d;for(;(c=a.result.shift())&&!(l(c,["itemName","url","pic","price","promotionPrice"])&&(c.promotionPrice&&(c.price=c.promotionPrice),c.extMap&&c.extMap.price20141212&&(c.price=c.extMap.price20141212),c.icon1212="",c.extMap&&c.extMap.mark20141212&&(c.icon1212='<i class="icon-1212"></i>'),c.extMap&&c.extMap.redpack20141212&&(c.icon1212='<i class="icon-1212-redpack"><s>\u8d2d\u7269\u52b5\u62b5</s><b></b><i></i><em>'+c.extMap.redpack20141212+"\u5143</em></i>"),d.list.push({name:i(c.itemName),extMap:i(c.extMap),url:i(c.url),pic:i(c.pic+"_80x80.jpg"),price:i(k(c.price)),icon1212:i(c.icon1212)}),d.list.length>=b)););return d}function i(a){return"string"==typeof a&&(a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/'/g,"&apos;"),a=a.replace(/"/g,"&quot;")),a}function j(a){var b=102,c=31;return 2*Math.floor((a-c)/b)}function k(a){return a>99999999?parseFloat(a/1e8).toFixed(1)+"\u4ebf":a>9999?parseFloat(a/1e4).toFixed(1)+"\u4e07":parseFloat(a).toFixed(2)}function l(a,b){var c,d=!0;for(c=0;c<b.length;c++)a.hasOwnProperty(b[c])||(d=!1);return d}var m=1,n=[];return a.augment(g,{request:function(b){var c=this;if(n[m-1])c.render(a.clone(n[m-1]));else{var e="tui.taobao.com",f=c.appid;null!==Hub.config.get("cdn_rate")&&(e=100*Math.random()>Hub.config.get("cdn_rate")?"tui.taobao.com":"htui.alicdn.com"),location.href.indexOf("daily")>-1&&(e="tui.daily.taobao.net",f=c.appid_daily),d({type:"get",url:"//"+e+"/recommend?appid="+f+"&count="+c.count+"&page="+m,data:{sellerid:c.sellerid,categoryid:c.categoryid,itemid:c.itemid},success:function(d){n[m-1]=a.clone(d),c.render(d,b)},error:function(b){a.log("detail_pine module ajax error: "+b)},dataType:"jsonp",jsonp:"callback",jsonpCallback:"detail_pine",cache:!0})}},render:function(b,c){var d=this;if(b&&b.result&&b.result.length>0){var f,g,i='<div class="refresh"></div>';1!=m||b.hasNext||(i='<div class="refresh hidden"></div>'),f="<ul>{{#each list as item index}}{{#if index=="+(b.result.length-1)+'}}<li class="tuijian-item last">{{#else}}<li class="tuijian-item">{{/if}}<div class="tuijian-l"><div class="tuijian-img clearfix"><div class="pic-con"><a href="{{item.url}}" title="{{item.name}}" target="_blank" class="img-con"><img src="{{item.pic}}" title="{{item.name}}" alt="{{item.name}}" />{{item.icon1212}}</a></div></div><p class="tuijian-price"><span class="now-price"><b class="yen">&yen;</b><b class="price">{{item.price}}</b></span></p></div></li>{{/each}}</ul>',g='<div class="tb-clearfix tuijian-module tuijian-module-detail-pine"><div class="tuijian-hd tb-clearfix"><div class="tuijian-l"><h2 class="tuijian-label">\u770b\u4e86\u53c8\u770b</h2></div><div class="tuijian-r">'+i+'</div></div><div class="tuijian-bd tb-clearfix">'+f+"</div></div>",c?d.container.html(e(g).render(h(b,d.count))).fadeIn(.3):a.one(".tuijian-bd",d.container).fadeOut(.3,function(){a.one(".tuijian-bd",d.container).html(e(f).render(h(b,d.count)))}).fadeIn(.3),b.hasNext&&3>m?m++:m=1}},bindEvent:function(){var a=this;a.container.delegate("click",".refresh",function(){(new f).log({},"minisite.3.1"),a.request(!1)})}}),g},{requires:["node","event",KISSY.version>="1.4.0"?"io":"ajax",KISSY.version>="1.3.0"?"gallery/template/1.0/":"template","recommend/mods/log/log","./page_pine_module.css"]});