KISSY.add("address-detail/wlroute",function(e,a,i,s,t,r){var d=a.all,n="\u8bf7\u9009\u62e9",l="J_WlAreaInfo",c="J_WlAddressCon",o="J_WlServiceInfo",u="J_WlServiceListCon",f="J_WlAreaTabs",v="J_WlAddressInfo",h="J_WlServiceTitle",m="J_ServiceMarkInfo",p="J_WlServiceTitleMark",g="wl-info-active",A="serviceFeeListInfo";FRAME_HTML=['<div class="wl-areainfo clearfix">','<span id="',l,'" class="wl-areacon"><span id="J-From"></span> \u81f3 <span id="J-To"></span></span><span class="loading" id="J-Loading"></span>',"</div>",'<div id="',o,'" class="wl-serviceinfo"></div>','<div id="',A,'" class="wl-serviceinfo"></div>','<div id="',p,'" class="wl-serviceinfo"></div>'].join(""),SERVICEPOP_HTML='<div class="wl-servicelist-con" id="'+u+'"></div>',ADDRESSTABCON_HTML='<div id="'+c+'" class="wl-addresslist-con"></div>',AREA_TEMP='<span class="wl-addressinfo" id="'+v+'" title="{{areaInfoAll}}">{{areaInfo}} <s></s></span>{{#if( markInfo !== undefined )}}<span>{{markInfo}}</span>{{/if}}',SERVICE_TEMP=["{{#if( id !== undefined )}}",'<span class="wl-servicetitle" id="',h,'">{{{info}}} <s></s></span>',"{{else}}","<span>{{{info}}}</span>","{{/if}}"].join(""),serviceFeeList_TEMP=["{{#if(serviceFeeList!==undefined)}}","{{#each(serviceFeeList)}}",'<span class="serviceFeeListInfo">{{serviceFeeSignText}}',"{{serviceFee/100}}\u5143 </span>","{{/each}}","{{/if}}"].join(""),SERVICE_TEMP_MARK=["{{#if( serviceIcon !== undefined )}}","{{#if( serviceLink !== undefined )}}",'<a target="_blank" href="{{serviceLink}}"><img height="12" style="vertical-align:text-bottom" src="{{serviceIcon}}"></a>',"{{else}}",'<img height="12" style="vertical-align:text-bottom" src="{{serviceIcon}}">',"{{/if}}","{{/if}}",'{{#if( markInfo !== undefined )}}<span class="wl-servicemarkinfo" id="',m,'">{{{markInfo}}}</span>',"{{/if}}"].join(""),LIST_TEMP=['<ul class="wl-list-con">',"{{#each(list)}}",'<li class="J-WlListItem wl-list-item {{#if (isDefault === true )}} wl-list-active {{/if}}" data-id="{{id}}" {{#if( markInfo !== undefined )}} data-markInfo="{{markInfo}}" {{/if}} data-title="{{info}}">{{{info}}} <s>&#xf00b2;</s></li>',"{{/each}}","</ul>"].join(""),LIST_ADDRESS_TEMP=['<ul class="wl-list-add-con clearfix">',"{{#each(list)}}",'<li class="J-WlListItem wl-list-item {{#if ( isDefault === true )}} wl-list-add-active {{/if}}" data-id="{{c}}" data-title="{{n}}" >{{{n}}}</li>',"{{/each}}","</ul>"].join(""),LIST_ADDRESS_ALL_TEMP=['<div class="wl-areatab-con" id="'+f+'">','<a href="#" id="J-PopupClose" class="address-all-close"></a><div id="J-AddressAllTitle" class="address-all-title-par clearfix">','<div class="address-all-title J-AddressTitle address-all-title-hidden" data-title="Province"  id="J-AddressAllTitle-province"></div>','<div class="address-all-title J-AddressTitle address-all-title-hidden" data-title="City"  id="J-AddressAllTitle-city"></div>','<div class="address-all-title J-AddressTitle address-all-title-hidden" data-title="Area"  id="J-AddressAllTitle-area"></div>','<div class="address-all-title J-AddressTitle address-all-title-hidden" data-title="Other"  id="J-AddressAllTitle-other"></div>',"</div>",'<div id="J-AddressAllCon" class="address-all-con-par clearfix">','<!--div class="address-all-con"  id="J-AddressAllCon"></div-->',"</div></div>"].join(""),jsTrackerSendArr=[],ajaxOr=false;function D(a){var i=this;i.arg=KISSY.merge({renderId:"",itemId:"",userId:"",skuId:"default",initData:"",initUrl:"",immediateRender:true,maxAddressLength:10,debug:false,addressUrl:"//division-data.alicdn.com/simple/addr_3_001.js",changeAnyInfo:function(){},renderAddressCallback:function(){},renderServiceCallback:function(){}},a);if(!i.arg.initData.data.serviceInfo){i.arg.initData.data.serviceInfo={}}if(!e.one("#"+i.arg.renderId)){return false}if(i.arg.immediateRender){if(i.arg.initData.data&&i.arg.initData.data.areaId){e.getScript(i.arg.addressUrl,{success:function(){i.addressDataAll=i._processData(tdist);i.arg.initData.data.userCity=(i.parseId(i.arg.initData.data.areaId)||{}).userCity;i.init()}})}else{i.init()}}}e.augment(D,{init:function(){var a=this;a.initTemplate();if(a.arg.initData.success){e.one("#"+a.arg.renderId).html(FRAME_HTML);a.areaEle=e.one("#"+l);a.fromEle=e.one("#J-From");a.toEle=e.one("#J-To");a.serviceEle=e.one("#"+o);a.checkAddressType()}else{a.errorFun("dataError",108,"\u7ec4\u4ef6\u4f20\u9012initData\u521d\u59cb\u5316\u6570\u636e\u6709\u8bef");return false}},initTemplate:function(){var e=this,a=s;e.areaTemp=new a(AREA_TEMP);e.serviceTemp=new a(SERVICE_TEMP);e.serviceTempMark=new a(SERVICE_TEMP_MARK);e.listTemp=new a(LIST_TEMP);e.listAddressTem=new a(LIST_ADDRESS_TEMP);e.serviceFeeListInfo=new a(serviceFeeList_TEMP)},checkAddressType:function(){var e=this,a=e.arg.initData.data;e.initData=a;e.editFrom();if(a.addressList&&a.addressList.length>0){e.createCY();e.jsTarckerSend({msg:"\u663e\u793a\u5e38\u7528\u6536\u8d27\u5730\u5740",category:"log",line:142,nick:e.arg.userId})}else{e.createSJ();e.jsTarckerSend({msg:"\u663e\u793a\u4e09\u7ea7\u5730\u5740",category:"log",line:142,nick:e.arg.userId})}},createCY:function(){var e=this,a=e.initData;e.addressListCY=a.addressList;e.addressData=e.checkoutDefault(a.addressList);e.editTo({addressInfo:e.addressData.info,addressMarkInfo:e.addressData.markInfo});e.createAddressListCY()},createSJ:function(){var e=this,a=e.initData;if(a.areaId&&Number(a.areaId)!=1&&a.areaName){}else{a.areaName="\u5168\u56fd";a.areaId="1";e.jsTarckerSend({msg:"\u663e\u793a\u4e09\u7ea7\u5730\u5740\uff0c\u4f46\u662f\u5b9a\u4f4d\u4e0d\u5230\u7528\u6237\u5730\u5740\uff0c\u663e\u793a\u5168\u56fd",category:"log",line:177,nick:e.arg.userId})}e.editTo({addressInfo:a.areaName,addressMarkInfo:a.markInfo});e.initPopupSimple("addressList",LIST_ADDRESS_ALL_TEMP,v);e.addressData={id:a.areaId,info:a.areaName,markInfo:a.markInfo};e.initSJEvent();e.arg.renderAddressCallback();e.createService()},initSJEvent:function(){var a=this;r.undelegate(document,"click","#"+v,arguments.cell);r.delegate(document,"click","#"+v,function(i){if(ajaxOr){return false}if(a.addressDataAll){a.initRequestAddressUrl(a.addressDataAll)}else{e.getScript(a.arg.addressUrl,{success:function(){var e=a._processData(tdist);a.initRequestAddressUrl(e)}});a.jsTarckerSend({msg:"\u5c55\u5f00\u4e09\u7ea7\u5730\u5740",category:"log",line:216,nick:a.arg.userId})}})},_processData:function(a){var i=this,s=a,t={},r;if(i.arg.mixAddressData){KISSY.mix(s,i.arg.mixAddressData,true)}e.each(s,function(e,a){r=s[a];if(r[1]==="0"){r[1]="990000"}if(!t[a]){t[a]={n:r[0],p:r[1],ch:[],c:a}}else{t[a].n=r[0];t[a].p=r[1];t[a].c=a}if(!t[r[1]]){t[r[1]]={ch:[a]}}else{t[r[1]].ch.push(a)}});return t},initRequestAddressUrl:function(a){var i=this;i.addressDataAll=a,areaData=a[i.addressData.id];i.subAddrD={};if(areaData&&Number(areaData.id)!=1){i.subAddrD=i.parseId(i.addressData.id)}else{i.subAddrD.userProvince={id:"1",name:"\u5168\u56fd"};i.subAddrD.level=1}i.createSJList(i.subAddrD);i.initEventSJ();i.showPop(e.one("#"+v),"addressListPupop")},initEventSJ:function(){var a=this,i=a.addressDataAll;d("#J-PopupClose").on("click",function(e){a.addressListPupop.hide();return false});d(".J-AddressTitle").on("click",function(s){var t=s.currentTarget,r=d(t).attr("data-title"),n=d(t).index();if(d(t).hasClass("address-all-title-selected")){return false}if(!a.subAddrDL){a.subAddrDL=e.clone(a.subAddrD)}if(n==2){delete a.subAddrDL.userArea;a.subAddrDL.userCity.child=i[a.subAddrDL.userCity.id].ch;a.subAddrDL.level=2}else if(n==1){delete a.subAddrDL.userArea;delete a.subAddrDL.userCity;a.subAddrDL.userProvince.child=i[a.subAddrDL.userProvince.id].ch;a.subAddrDL.level=1}else if(n==0){a.subAddrDL={level:1,userProvince:{id:"1",name:"\u5168\u56fd"}}}a.clearTitleTabsSJ(n);a.createSJList(a.subAddrDL)})},clearTitleTabsSJ:function(a){var i=this;e.filter(d(".J-AddressTitle"),function(e,i){if(i>a){d(e).removeClass("address-all-title-selected").addClass("address-all-title-hidden").html("")}})},createSJList:function(e){var a=this,i=e,s=i.level;if(this.arg.lang=="zh_TW"){n="\u8acb\u9078\u64c7"}d(".J-AddressTitle").removeClass("address-all-title-selected").addClass("address-all-title-hidden").html("");if(s==1){if(i.userProvince.child&&i.userProvince.child.length>0){a.displayTitleSJ("province",i.userProvince.name,{selectId:i.userProvince.id},false);a.displayTitleSJ("city",n,{parId:i.userProvince.id},true)}else{a.displayTitleSJ("province",n,{parId:1},true)}}else if(s==2){a.displayTitleSJ("province",i.userProvince.name,{selectId:i.userProvince.id},false);if(i.userCity.child&&i.userCity.child.length>0){a.displayTitleSJ("city",i.userCity.name,{selectId:i.userCity.id},false);a.displayTitleSJ("area",n,{parId:i.userCity.id},true)}else{a.displayTitleSJ("city",i.userCity.name,{selectId:i.userCity.id},true)}}else{if(i.userProvince.id=="990000"){a.displayTitleSJ("province",i.userProvince.name,{selectId:i.userProvince.id},false);a.displayTitleSJ("city",i.userCity.name,{selectId:i.userCity.id},false);a.displayTitleSJ("area",i.userArea.name,{selectId:i.userArea.id},false);if(s==4){a.displayTitleSJ("other",n,{selectId:i.userOther.id},true)}else{a.displayTitleSJ("other",n,{parId:i.userArea.id},true)}return}a.displayTitleSJ("province",i.userProvince.name,{selectId:i.userProvince.id},false);a.displayTitleSJ("city",i.userCity.name,{selectId:i.userCity.id},false);a.displayTitleSJ("area",i.userArea.name,{selectId:i.userArea.id},true)}},displayTitleSJ:function(e,a,i,s){var t=this;if(!s){d("#J-AddressAllTitle-"+e).removeClass("address-all-title-selected address-all-title-hidden").html(a+"<s></s>")}else{t.listAddressSj(t.listAddressTem.render(t.findSiblingsSJ(i)));d("#J-AddressAllTitle-"+e).removeClass("address-all-title-hidden").addClass("address-all-title-selected").html(a+"<s></s>")}},listAddressSj:function(e){var a=this,i=a.addressDataAll;d("#J-AddressAllCon").addClass("address-all-con-selected").html(e);d("#J-AddressAllCon .J-WlListItem").on("click",function(e){var s=e.currentTarget,t=d(s).attr("data-id");if(d(s).hasClass("wl-list-add-active")){a.addressListPupop.hide();return false}d("#J-AddressAllCon .J-WlListItem").removeClass("wl-list-add-active");d(s).addClass("wl-list-add-active");if(i[t].ch&&i[t].ch.length>0){a.subAddrDL=a.parseId(t);a.createSJList(a.subAddrDL)}else{a.endEditAddrSJ(t)}})},endEditAddrSJ:function(e){var a=this;a.addressData={id:e,info:a.addressDataAll[e].n};delete a.subAddrDL;a.subAddrD=a.parseId(e);a.addressListPupop.hide();d("#"+v).html(a.returnTitle(a.subAddrD)+"<s></s>");if(a.arg.initUrl){a.ajaxFun({url:a.arg.initUrl,jsonpCallback:"jsonp211",data:{areaId:a.addressData.id,itemId:a.arg.itemId}},a.requestInitURL,a.returnAllData)}else{a.returnAllData()}a.jsTarckerSend({msg:"\u5207\u6362\u4e86\u4e09\u7ea7\u5730\u5740",category:"log",line:400,nick:a.arg.userId})},findSiblingsSJ:function(a){var i=this,s=i.addressDataAll,t=[],r;if(a.selectId){r=s[s[a.selectId].p].ch;e.each(r,function(e,i){if(e!=a.selectId){s[e].isDefault=false}else{s[e].isDefault=true}t.push(s[e])})}else{r=s[a.parId].ch;e.each(r,function(e,a){s[e].isDefault=false;t.push(s[e])})}return{list:t}},parseId:function(e){var a=this,i=a.addressDataAll,s={userProvince:{id:"1",name:"\u5168\u56fd"},level:1};var t=i[e];if(!i[e]||Number(e)==1){return s}if(Number(t.p)==1){s={userProvince:{id:t.c,name:t.n,child:t.ch},level:1};return s}if(t.ch&&t.ch.length>0){if(i[t.p].p==="990000"){s={userProvince:{id:i[t.p].p,name:i[i[t.p].p].n},userCity:{id:t.p,name:i[t.p].n},userArea:{id:t.c,name:t.n},level:3}}else{s={userCity:{id:e,name:t.n,child:t.ch},userProvince:{id:t.p+"",name:i[t.p].n},level:2}}}else{if(i[i[t.p].p].p=="990000"){s={userProvince:{id:this.getParseData(t,1).c,name:this.getParseData(t,1).n},userCity:{id:this.getParseData(t,2).c,name:this.getParseData(t,2).n},userArea:{id:t.p,name:i[t.p].n},userOther:{id:t.c,name:t.n},level:4}}else if(Number(i[t.p].p)!=1){s={userProvince:{id:i[t.p].p,name:i[i[t.p].p].n},userCity:{id:t.p,name:i[t.p].n},userArea:{id:t.c,name:t.n},level:3}}else{s={userProvince:{id:t.p,name:i[t.p].n},userCity:{id:t.c,name:t.n},level:2}}}return s},editFrom:function(){var e=this;if(e.initData.sendCity){e.fromEle.text(e.initData.sendCity)}else{e.fromEle.text("\u5168\u56fd")}},editTo:function(e){var a=this;a.toEle.html(a.areaTemp.render({areaInfoAll:e.addressInfo,areaInfo:a.cutWords(e.addressInfo,a.arg.maxAddressLength),markInfo:e.addressMarkInfo}))},getParseData:function(e,a){var i=this.addressDataAll;var s=0;var t=[];while(e.p!="1"){s++;e=i[e.p];t.push(e)}return t[t.length-a]},createAddressListCY:function(){var e=this;e.initPopupSimple("addressList",ADDRESSTABCON_HTML,v);d("#"+c).html(e.listTemp.render({list:e.addressListCY,title:"\u5e38\u7528\u6536\u8d27\u5730\u5740"}));e.initAddressTitleEvent("addressListPupop",v);e.initSingleListEvent(c,v,function(a){if(a!=undefined){e.addressData=e.initData.addressList[a];e.editTo({addressInfo:e.addressData.info,addressMarkInfo:e.addressData.markInfo});if(e.arg.initUrl){e.ajaxFun({url:e.arg.initUrl,jsonpCallback:"jsonp211",data:{areaId:e.addressData.id,itemId:e.arg.itemId}},e.requestInitURL,e.returnAllData)}else{e.returnAllData()}e.jsTarckerSend({msg:"\u5207\u6362\u4e86\u5e38\u7528\u6536\u8d27\u5730\u5740",category:"log",line:544,nick:e.arg.userId})}e["addressListPupop"].hide()});e.arg.renderAddressCallback();e.createService()},requestInitURL:function(e){var a=this;if(e&&e.success&&e.data){var e=e.data;a.initData=e;a.fromEle.text(e.sendCity);a.createService()}else{a.errorFun("requestError",583,"\u5207\u6362\u5730\u5740\u53d1\u8d77\u7684\u8bf7\u6c42\u8fd4\u56de\u6570\u636e\u51fa\u9519")}},initAddressTitleEvent:function(e,a){var i=this;r.undelegate(document,"click","#"+a,arguments.cell);r.delegate(document,"click","#"+a,function(a){i.showPop(a.currentTarget,e)})},initSingleListEvent:function(e,a,i){var s=this;r.undelegate("#"+e,"click",".J-WlListItem",arguments.cell);r.delegate("#"+e,"click",".J-WlListItem",function(e){if(!d(e.currentTarget).hasClass("wl-list-active")){d(e.currentTarget).addClass("wl-list-active").siblings().removeClass("wl-list-active");i(d(e.currentTarget).index())}else{i()}})},checkoutDefault:function(a){var i={};e.each(a,function(e,a){if(e.isDefault){i=e;return false}});return i},createService:function(e){var a=this;a.serviceData=a.initServiceDataFun(a.initData.serviceInfo,a.arg.skuId);d("#"+o).html(a.serviceTemp.render(a.serviceData));d("#"+p).html(a.serviceTempMark.render(a.serviceData));d("#"+A).html(a.serviceFeeListInfo.render(a.serviceData));if(a.serviceListData){a.initPopupSimple("serviceList",SERVICEPOP_HTML,h);d("#"+u).html(a.listTemp.render({list:a.serviceListData,title:"\u7269\u6d41\u670d\u52a1"}));a.initAddressTitleEvent("serviceListPupop",h);a.initSingleListEvent(u,h,function(e){if(e!=undefined){a.jsTarckerSend({msg:"\u5207\u6362\u4e86\u7269\u6d41\u670d\u52a1",category:"log",line:637,nick:a.arg.userId});a.serviceData=a.serviceListData[e];d("#"+o).html(a.serviceTemp.render(a.serviceData));d("#"+p).html(a.serviceTempMark.render(a.serviceData));d("#"+A).html(a.serviceFeeListInfo.render(a.serviceData));a.returnAllData()}a["serviceListPupop"].hide()})}a.arg.renderServiceCallback();a.returnAllData(e)},initServiceDataFun:function(e,a){var i=this;if(e.info){return{info:e.info.info}}else if(e.list&&e.list.length>0){i.serviceListData=e.list;return i.checkoutDefault(e.list)}else if(e.sku){return i.skuChanged(a)}},skuChanged:function(e){var a=this;if(e){if(!a.initData.serviceInfo.sku[e]){e="default"}a.jsTarckerSend({msg:"\u5207\u6362\u4e86sku",category:"log",line:688,nick:a.arg.userId});a.serviceSkuId=e;a.serviceListData=a.initData.serviceInfo.sku[e];return a.checkoutDefault(a.serviceListData)}},onChangeSku:function(e,a){var i=this;if(!i.initData.serviceInfo.sku||!i.initData.serviceInfo.sku[e]){e="default"}if(e!=i.serviceSkuId){i.arg.skuId=e;i.createService(a)}},returnAllData:function(a){var i=this,s={addressData:i.getCustomAreaInfo(),serviceData:i.getCustomServiceInfo(),requestInitUrlData:i.getRequestInitUrlData(),initData:i.arg.initData.data};if(a){s.changeSkuByUser=a}if(i.subAddrD){s.addressData=e.merge(s.addressData,i.subAddrD)}i.arg.changeAnyInfo(s)},getCustomAreaInfo:function(){var e=this;return{itemId:e.arg.itemId,sendCity:e.initData.sendCity,userArea:{id:e.addressData.id,name:e.addressData.info},userId:e.arg.userId}},getCustomServiceInfo:function(){return this.serviceData},getRequestInitUrlData:function(){return this.initData},showPop:function(a,i){a=e.one(a);var s=this,t,r,n=d("#"+s.arg.renderId).offset();if(!a.hasClass(g)){t=s[i];r=a.offset();t.set("xy",[r.left,r.top+20]);t.show()}},returnTitle:function(e){var a=this,i=e,s="";if(i.userProvince){s+=i.userProvince.name}if(i.userCity){if(s!=i.userCity.name){s+=i.userCity.name}}if(i.userArea){s+=i.userArea.name}if(i.userOther){s+=i.userOther.name}s=s.replace("\u56fd\u9645","");return s},ajaxFun:function(a,s,t){var r=this,n={type:"get",timeout:10,dataType:"jsonp",success:function(e){d("#J-Loading").hide();ajaxOr=false;s.call(r,e)},error:function(e,a){d("#J-Loading").hide();t.call(r);ajaxOr=false;r.errorFun(a,761,"ajax\u8bf7\u6c42\u6570\u636e\u51fa\u9519:")}};n=e.merge(n,a);i(n)},showLoading:function(){var e=this;ajaxOr=true;if(e.arg.requestShowLoading){d("#J-Loading").show()}},initPopupSimple:function(e,a,i){var s=this,r=s[e+"Pupop"];if(!r){r=new t.Popup({content:a,zIndex:999,triggerType:"click",mask:{closeOnClick:true}});r.render();s[e+"Pupop"]=r;r.on("show",function(){d("#"+i).addClass(g)});r.on("hide",function(){delete s.subAddrDL;d("#"+i).removeClass(g)})}},errorFun:function(e,a,i){var s=this;var t=e.toLowerCase()==="timeout"?"(\u8bf7\u6c42\u8d85\u65f6)":"(\u7cfb\u7edf\u51fa\u9519)";if(e=="dataError"){t=""}if(i){i+=t}else{i=t}s.jsTarckerSend({msg:i,line:a,nick:s.arg.userId})},cutWords:function(e,a){if(e&&e.length>a){e=e.slice(0,a)+"..."}return e},loadJsTracker:function(){var e=this,a=document.getElementsByTagName("head")[0],i=document.createElement("script");i.setAttribute("type","text/javascript");i.setAttribute("id","JSTrackerCCEle");i.setAttribute("src","//g.alicdn.com/ccc/bird-jstracker/1.0.2/jstracker.js");a.appendChild(i);return i},jsTarckerSend:function(e){var a=this;try{if(e){if(a.arg.debug){e.debug=true}jsTrackerSendArr.push(e)}if(window.JSTrackerCC&&jsTrackerSendArr.length>0){for(var i=0,s=jsTrackerSendArr.length;i<s;i++){JSTrackerCC.send(jsTrackerSendArr[i])}jsTrackerSendArr=[]}else{if(d("#JSTrackerCCEle").length==0){var t=a.loadJsTracker();t.onload=t.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"||this.readyState==="complete"){a.jsTarckerSend()}}}}}catch(r){}}});return D},{requires:["node","io","kg/xtemplate/4.3.0/","kg/overlay/6.1.3/","event","address-detail/wlroute.css"]});