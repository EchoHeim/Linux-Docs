KISSY.add("item-recommend/__7",["item-recommend/p/tad/index.css","node","io","xtemplate/runtime","cookie","item-recommend/__3","item-recommend/__5","item-recommend/__8"],function(t,e){e("item-recommend/p/tad/index.css");var a=e("node").all,n=e("io"),i=e("xtemplate/runtime"),r=e("cookie"),o=e("item-recommend/__3"),d=e("item-recommend/__5");d.init();var c=[];c.tad_first_area=e("item-recommend/__8");var s=!1,m=!1,l=0,f=!1,u=null,_=0,h={init:function(t){var e=this;e.data=t.data,e.extraOption();try{e.render()}catch(n){a("body").fire("track",{msg:{url:location.href},category:"recommend:render:false"})}e.load(),e.bindEvent()},render:function(){var e=this;e.data&&e.data.tad_first_area&&t.each(e.data.tad_first_area,function(t){return 4==t.type?(e.data.tad_first_area.unshift({name:"1212",type:12}),!1):void 0}),t.each(e.data,function(e,n){if(e&&o[n]&&c[n]){var r=a(o[n].container),d=o[n].items,s=[];t.each(e,function(e){e=t.merge(e,d[e.type]),s.push(e)}),r.html(new i(c[n]).render({data:s}))}})},reflow:function(e){var n=d.get(),i=n[e].items,r=n[e].showType,o=a("#"+e);0>r?o.hide():o.show(),"tad_first_area"==e&&(o.all(".tb-tad-nav").each(function(){var e=a(this).attr("data-type");e==r?a(this).addClass("selected"):a(this).removeClass("selected"),t.inArray(parseInt(e),i)||a(this).remove()}),o.all(".tad-tabcon-anchor").each(function(){var e=a(this).attr("data-type");e!=r?a(this).addClass("tb-tad-hidden"):a(this).removeClass("tb-tad-hidden"),t.inArray(parseInt(e),i)||a(this).remove()}))},_reflowSingleModInFirstArea:function(e){var n=d.get(),i=a("#tad_first_area"),r=n.tad_first_area.items,o=n.tad_first_area.showType,c=e.modName;if(0>o?i.hide():i.show(),"HeartElection"==c)var s="4";else if("MatchingCombo"==c)s="8";else{if("1212"!=c)return;s="12"}i.all(".tb-tad-nav").each(function(){var e=a(this).attr("data-type");e==o?a(this).addClass("selected"):a(this).removeClass("selected"),t.inArray(parseInt(s),r)&&e==s&&a(this).css({display:"inline"})}),i.all(".tad-tabcon-anchor").each(function(){var t=a(this).attr("data-type");t!=o?a(this).addClass("tb-tad-hidden"):a(this).removeClass("tb-tad-hidden")})},load:function(){var e=this,n=!1,i=!1,r=[],c=[];t.each(e.data,function(e,a){e&&o[a]&&t.each(e,function(t){var e=o[a].items[t.type];d.add(a,t.type),"ShopPromo"==e.modName||"MatchingCombo"==e.modName?(n||(n=!0),r.push(e)):("HeartElection"==e.modName||"1212"==e.modName)&&(i||(i=!0),c.push(e))})}),!n&&(m=!0),n&&e.extraRequest(function(n){t.each(r,function(i){t.use(i.modPath,function(t,o){try{o&&new o({container:i.container,data:n,successFn:function(){e.isAllUmpModInited(r.length),"MatchingCombo"==i.modName&&e._reflowSingleModInFirstArea(i)},errorFn:function(){e.isAllUmpModInited(r.length),"MatchingCombo"==i.modName&&(d.rm("tad_first_area",8),e.reflow("tad_first_area"))}}).init()}catch(c){a("body").fire("track",{msg:{url:location.href},category:"recommend:exec:false"})}})})},function(){a("body").fire("track",{msg:{url:location.href,category:"recommend:request:false:umperror"}})}),i?e.tadRequestCombo(function(n){t.each(c,function(i){t.use(i.modPath,function(t,r){try{r&&new r({container:i.container,data:n,successFn:function(){e.isAllTadModInited(c.length),e._reflowSingleModInFirstArea(i)},errorFn:function(){"HeartElection"==i.modName?d.rm("tad_first_area",4):"1212"==i.modName&&d.rm("tad_first_area",12),e.isAllTadModInited(c.length),e.reflow("tad_first_area")}}).init()}catch(o){a("body").fire("track",{msg:{url:location.href},category:"recommend:exec:false"})}})})},function(){a("body").fire("track",{msg:{url:location.href,category:"recommend:request:false:customtaddata"}})}):a("body").fire("resource:sib",{success:function(){g_config&&g_config.sellerDetail&&g_config.sellerDetail.show&&(e.data.tad_first_area||(e.data.tad_first_area=[]),e.data.tad_first_area.push({name:"\u638c\u67dc\u63a8\u8350",type:4}),d.add("tad_first_area",12),d.add("tad_first_area",4),e.render(),e.tadRequestCombo2(function(n){var i=[o.tad_first_area.items[12],o.tad_first_area.items[4]];t.each(i,function(r){t.use(r.modPath,function(t,o){try{o&&new o({container:r.container,data:n,successFn:function(){"1212"==r.modName&&d.switchTo("tad_first_area",12),e.isAllTadModInited(i.length),e._reflowSingleModInFirstArea(r)},errorFn:function(){"HeartElection"==r.modName?d.rm("tad_first_area",4):"1212"==r.modName&&d.rm("tad_first_area",12),e.isAllTadModInited(i.length),e.reflow("tad_first_area")}}).init()}catch(c){a("body").fire("track",{msg:{url:location.href},category:"recommend:exec:false"})}})})},function(){a("body").fire("track",{msg:{url:location.href,category:"recommend:request:false:defaultplan"}})}))}})},bindEvent:function(){var t=this,e=a("#tad_first_area");e.on("click",function(e){var n=e.target;if(a(n).hasClass("tb-tad-nav")||a(n).hasClass("tb-tab-anchor")){e.preventDefault();var i=a(n).parent(".tb-tad-nav")||a(n),r=i.attr("data-type");t.goldLog(r),d.switchTo("tad_first_area",r),t.reflow("tad_first_area"),"4"==r&&Stat.sendStatistic("/sitem.5.1")}})},extraRequest:function(e,a){var i=g_config.idata&&g_config.idata.seller&&g_config.idata.seller.id,r=g_config.tadComponetCdn,o=g_config.itemId,d=!!~location.href.indexOf("daily"),c=d?"daily.taobao.net":"taobao.com";if(r)var s="//otds.alicdn.com/json/MMComponent.htm?mjs=1&meal=1&userId="+i+"&itemId="+o;else s="//detailskip."+c+"/json/MMComponent.htm?mjs=1&meal=1&userId="+i+"&itemId="+o;var m={url:s,type:"get",dataType:"jsonp",success:function(t){e&&e(t)},error:function(){a&&a()}};r&&t.mix(m,{jsonpCallback:"fromCdn",cache:!0}),new n(m)},extraOption:function(){var t=a("#tad_head_area"),e=a("#tad_first_area");0===t.length&&a('<div id="tad_head_area"></div>').insertBefore(e)},tadRequestCombo:function(t,e){a("body").fire("resource:sib",{success:function(){var a=!!~location.href.indexOf("daily"),i=a?"//tad.daily.taobao.net":"//tad.taobao.com",o={};g_config.vdata&&g_config.vdata.viewer&&g_config.vdata.viewer.id?o.buyerid=g_config.vdata.viewer.id:o.buyerid=r.get("cna"),o.sellerid=g_config.sellerId,o.cna=r.get("cna"),o.itemid=g_config.itemId,o.catid=g_config.idata.item.cid,o.appid=1,o.areaid="tad_first_area";var d=i+"/api/list";g_config&&g_config.sellerDetail&&g_config.sellerDetail.show&&(o.self=1),new n({url:d,type:"get",dataType:"jsonp",data:o,timeout:3e3,jsonp:"callback",error:function(){e&&e()},success:function(e){t&&t(e)}})}})},tadRequestCombo2:function(t,e){var a=!!~location.href.indexOf("daily"),i=a?"//tad.daily.taobao.net":"//tad.taobao.com",o={};g_config.vdata&&g_config.vdata.viewer&&g_config.vdata.viewer.id?o.buyerid=g_config.vdata.viewer.id:o.buyerid=r.get("cna"),o.sellerid=g_config.sellerId,o.cna=r.get("cna"),o.itemid=g_config.itemId,o.catid=g_config.idata.item.cid,o.appid=1,o.areaid="tad_first_area";var d=i+"/api/list";g_config&&g_config.sellerDetail&&g_config.sellerDetail.show&&(o.self=1),new n({url:d,type:"get",dataType:"jsonp",data:o,timeout:3e3,jsonp:"callback",error:function(){e&&e()},success:function(e){t&&t(e)}})},isAllTadModInited:function(e){var a=this;if(_++,_===e){var n=d.get(),i=n.tad_first_area.items,r=n.tad_first_area.showType;!f&&r&&t.inArray(parseInt(r),i)&&(a.goldLog(r),f=!0),s=!0,a.isAllModsLoaded()}},isAllUmpModInited:function(t){var e=this;l++,l===t&&(m=!0,e.isAllModsLoaded())},isAllModsLoaded:function(){s&&m&&a("body").fire("component:loaded",{name:"tad"})},goldLog:function(t){function e(t){var e=new Image;return e.src=t}if(null===u||u!=t)try{u=t;var n="//gm.mmstat.com/shopflow.";if(4==t){var i=a(o.tad_first_area.items[4].container),r=i.attr("whichplan");if("default"==r)goldlog&&goldlog.record("/shopflow.5.1","","","H46807174");else if("custom"==r){var d=i.attr("taskid"),c=i.attr("templatetype");n+="3."+d+"?template="+c+"&t="+(new Date).getTime(),e(n)}}else if(12==t){if(a("#J_Tad1212 .tad12_guide_area").length||a("#J_Tad1212 .tad12_guide_success_tip").length)return;goldlog&&goldlog.record("/shopflow.5.2","","","H46807196")}}catch(s){a("body").fire("track",{msg:{url:location.href},category:"recommend:goldlog:false"})}}};return h}),KISSY.add("item-recommend/__6",function(t,e){var a={sendStatistic:function(e){e&&((new Image).src="//gm.mmstat.com"+e+"?cache="+t.now())}};return window.Stat=a,a}),KISSY.add("item-recommend/__3",function(){var t={tad_head_area:{style:"block",container:"#tad_head_area",items:{7:{title:"\u6ee1\u5c31\u9001",modName:"ShopPromo",container:"#tad_head_area",modPath:"item-recommend/c/shop-promo/"}}},tad_first_area:{style:"tab",container:"#tad_first_area",items:{4:{title:"\u638c\u67dc\u63a8\u8350",modName:"HeartElection",container:"#J_TadHeartElection",modPath:"item-recommend/c/heart-election/"},8:{title:"\u642d\u914d\u5957\u9910",modName:"MatchingCombo",container:"#J_TadMatchingCombo",modPath:"item-recommend/c/matching-combo/"},9:{title:"\u81ea\u7531\u642d\u914d",modName:"3",modPath:""},12:{title:"1212",modName:"1212",container:"#J_Tad1212",modPath:"item-recommend/c/1212/"}}},tad_second_area:{style:"block",items:{4:{title:"\u638c\u67dc\u63a8\u8350",container:"#tad_second_area",modName:"",modPath:""}}}};return t}),KISSY.add("item-recommend/__5",["node","item-recommend/__3"],function(t,e){var a=(e("node").all,e("item-recommend/__3")),n={plugins:{},init:function(e){var n=this,e=e||a;return t.each(e,function(t,e){n.plugins[e]={},n.plugins[e].items=[],n.plugins[e].showType=-1}),n.plugins},add:function(t,e){var a=this.plugins,n=a[t].items;return n.length>0?n.push(e):(n.push(e),a[t].showType=e),a},rm:function(e,a){a=parseInt(a);var n=this.plugins,i=t.indexOf(a,n[e].items);return i>-1&&n[e].items.splice(i,1),n[e].showType=n[e].items.length>0?n[e].items[0]:-1,n},switchTo:function(t,e){var a=this.plugins;a[t].showType=e},get:function(){return this.plugins}};return n}),KISSY.add("item-recommend/__8",function(t,e,a,n){return function(t,e,a){var i,r="",o=this.config,d=this,c=o.utils;"undefined"!=typeof n&&n.kissy&&(i=n);var s=c.runBlockCommand,m=c.renderOutput,l=c.getProperty,f=(c.runInlineCommand,c.getPropertyOrRunCommand);r+='<div class="tb-tad-first-area tb-clearfix">\n    <div class="tb-tad-tabbar-inner-wrap">\n        <ul class="tb-tabbar clear" id="J_TadTabBar">\n            ';var u={},_=[],h=l(d,t,"data",0,4);_.push(h),u.params=_,u.fn=function(t){var e="";e+='\n            <li class="tb-tad-nav ';var a={},n=[],i=l(d,t,"xindex",0,5);n.push(0===i),a.params=n,a.fn=function(t){var e="";return e+=" selected "},e+=s(d,t,a,"if",5),e+=" ";var r={},o=[],c=l(d,t,"type",0,5);o.push(12===c),r.params=o,r.fn=function(t){var e="";return e+="tb-tad-nav-1212"},e+=s(d,t,r,"if",5),e+='" data-type="';var u=f(d,t,{},"type",0,5);e+=m(u,!0),e+='">\n                <a class="tb-tab-anchor" href="#" hidefocus="true"> ';var _=f(d,t,{},"name",0,6);return e+=m(_,!0),e+=' </a>\n                <div class="tb-selected-indicator" href="#"></div>\n            </li>\n            '},r+=s(d,t,u,"each",4),r+='\n        </ul>\n    </div>\n    <div class="tb-tad-tabcon-inner-wrap">\n        ';var g={},p=[],v=l(d,t,"data",0,13);return p.push(v),g.params=p,g.fn=function(t){var e="";e+='\n            <div class="tad-tabcon-anchor ';var a={},n=[],i=l(d,t,"xindex",0,14);n.push(0!==i),a.params=n,a.fn=function(t){var e="";return e+=" tb-tad-hidden "},e+=s(d,t,a,"if",14),e+='" id="J_Tad';var r=f(d,t,{},"modName",0,14);e+=m(r,!0),e+='" data-type="';var o=f(d,t,{},"type",0,14);return e+=m(o,!0),e+='">\n\n            </div>\n        '},r+=s(d,t,g,"each",13),r+="\n    </div>\n</div>\n\n\n"}}),KISSY.add("item-recommend/_8",["base","item-recommend/__7","item-recommend/__6"],function(t,e){function a(t){var e=this;a.superclass.constructor.call(e,t),e.init(t)}var n=e("base"),i=e("item-recommend/__7");return e("item-recommend/__6"),a.ATTRS={},t.mix(a,t.EventTarget),t.extend(a,n,{init:function(t){this.buildConfig(t),i.init(this.config)},buildConfig:function(e){this.config=t.mix(a.ATTRS,e,!0,null,!0)}}),window.Tad=a,a});